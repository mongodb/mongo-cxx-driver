<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>MongoDB C++ Driver: mongo::ReplicaSetMonitor Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MongoDB C++ Driver
   &#160;<span id="projectnumber">legacy-1.1.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="hierarchy.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacemongo.html">mongo</a></li><li class="navelem"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html">ReplicaSetMonitor</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-static-methods">Static Public Member Functions</a> &#124;
<a href="#pub-static-attribs">Static Public Attributes</a> &#124;
<a href="classmongo_1_1ReplicaSetMonitor-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">mongo::ReplicaSetMonitor Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Holds state about a replica set and provides a means to refresh the local view.  
 <a href="classmongo_1_1ReplicaSetMonitor.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="replica__set__monitor_8h_source.html">replica_set_monitor.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmongo_1_1ReplicaSetMonitor_1_1IsMasterReply.html">IsMasterReply</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor_1_1Refresher.html">Refresher</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Refreshes the local view of a replica set.  <a href="classmongo_1_1ReplicaSetMonitor_1_1Refresher.html#details">More...</a><br /></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmongo_1_1ReplicaSetMonitor_1_1ScanState.html">ScanState</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structmongo_1_1ReplicaSetMonitor_1_1SetState.html">SetState</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:aa31cc064ed6f97cca5190304bfb47812"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#aa31cc064ed6f97cca5190304bfb47812">ReplicaSetMonitor</a> (<a class="el" href="classmongo_1_1StringData.html">StringData</a> name, const std::set&lt; <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &gt; &amp;seeds)</td></tr>
<tr class="memdesc:aa31cc064ed6f97cca5190304bfb47812"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializes local state.  <a href="#aa31cc064ed6f97cca5190304bfb47812">More...</a><br /></td></tr>
<tr class="separator:aa31cc064ed6f97cca5190304bfb47812"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a62b9158339c4762dda3303c0f1d21d42"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a62b9158339c4762dda3303c0f1d21d42">getHostOrRefresh</a> (const <a class="el" href="structmongo_1_1ReadPreferenceSetting.html">ReadPreferenceSetting</a> &amp;criteria)</td></tr>
<tr class="memdesc:a62b9158339c4762dda3303c0f1d21d42"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a host matching criteria or an empty <a class="el" href="structmongo_1_1HostAndPort.html" title="Name of a process on the network. ">HostAndPort</a> if no host matches.  <a href="#a62b9158339c4762dda3303c0f1d21d42">More...</a><br /></td></tr>
<tr class="separator:a62b9158339c4762dda3303c0f1d21d42"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc78b4c336cec685a4ca13e00ba0337b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#acc78b4c336cec685a4ca13e00ba0337b">getMasterOrUassert</a> ()</td></tr>
<tr class="memdesc:acc78b4c336cec685a4ca13e00ba0337b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the host we think is the current master or uasserts.  <a href="#acc78b4c336cec685a4ca13e00ba0337b">More...</a><br /></td></tr>
<tr class="separator:acc78b4c336cec685a4ca13e00ba0337b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a61b9142e147364322c0868022182777b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classmongo_1_1ReplicaSetMonitor_1_1Refresher.html">Refresher</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a61b9142e147364322c0868022182777b">startOrContinueRefresh</a> ()</td></tr>
<tr class="memdesc:a61b9142e147364322c0868022182777b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a refresher object that can be used to update our view of the set.  <a href="#a61b9142e147364322c0868022182777b">More...</a><br /></td></tr>
<tr class="separator:a61b9142e147364322c0868022182777b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a07049d6895d074584d0e653fb4614a50"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a07049d6895d074584d0e653fb4614a50">failedHost</a> (const <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &amp;host)</td></tr>
<tr class="memdesc:a07049d6895d074584d0e653fb4614a50"><td class="mdescLeft">&#160;</td><td class="mdescRight">Notifies this Monitor that a host has failed and should be considered down.  <a href="#a07049d6895d074584d0e653fb4614a50">More...</a><br /></td></tr>
<tr class="separator:a07049d6895d074584d0e653fb4614a50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a59f52b0e9943e3544ccee8c68bb0eea4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a59f52b0e9943e3544ccee8c68bb0eea4">isPrimary</a> (const <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &amp;host) const </td></tr>
<tr class="memdesc:a59f52b0e9943e3544ccee8c68bb0eea4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if this node is the master based ONLY on local data.  <a href="#a59f52b0e9943e3544ccee8c68bb0eea4">More...</a><br /></td></tr>
<tr class="separator:a59f52b0e9943e3544ccee8c68bb0eea4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace3b3df4b50ace722cccd548c7b032c5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ace3b3df4b50ace722cccd548c7b032c5"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#ace3b3df4b50ace722cccd548c7b032c5">isHostUp</a> (const <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &amp;host) const </td></tr>
<tr class="memdesc:ace3b3df4b50ace722cccd548c7b032c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if host is part of this set and is considered up (meaning it can accept queries). <br /></td></tr>
<tr class="separator:ace3b3df4b50ace722cccd548c7b032c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a03e64dd980c40a7c58afe1035eb82a7e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a03e64dd980c40a7c58afe1035eb82a7e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a03e64dd980c40a7c58afe1035eb82a7e">getConsecutiveFailedScans</a> () const </td></tr>
<tr class="memdesc:a03e64dd980c40a7c58afe1035eb82a7e"><td class="mdescLeft">&#160;</td><td class="mdescRight">How may times in a row have we tried to refresh without successfully contacting any hosts who claim to be members of this set? <br /></td></tr>
<tr class="separator:a03e64dd980c40a7c58afe1035eb82a7e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16e66cb856eb6f377811b3785d7fdb39"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a16e66cb856eb6f377811b3785d7fdb39"></a>
std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a16e66cb856eb6f377811b3785d7fdb39">getName</a> () const </td></tr>
<tr class="memdesc:a16e66cb856eb6f377811b3785d7fdb39"><td class="mdescLeft">&#160;</td><td class="mdescRight">The name of the set. <br /></td></tr>
<tr class="separator:a16e66cb856eb6f377811b3785d7fdb39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7841a80e84632cb2e1b946a277c52520"><td class="memItemLeft" align="right" valign="top">std::string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a7841a80e84632cb2e1b946a277c52520">getServerAddress</a> () const </td></tr>
<tr class="memdesc:a7841a80e84632cb2e1b946a277c52520"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a string with the format name/server1,server2.  <a href="#a7841a80e84632cb2e1b946a277c52520">More...</a><br /></td></tr>
<tr class="separator:a7841a80e84632cb2e1b946a277c52520"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d00ddb0cb56e2e33119d741e76b034d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8d00ddb0cb56e2e33119d741e76b034d"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a8d00ddb0cb56e2e33119d741e76b034d">contains</a> (const <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &amp;server) const </td></tr>
<tr class="memdesc:a8d00ddb0cb56e2e33119d741e76b034d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Is server part of this set? Uses only cached information. <br /></td></tr>
<tr class="separator:a8d00ddb0cb56e2e33119d741e76b034d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a590a68a82624200dcdfdb540a17e2140"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a590a68a82624200dcdfdb540a17e2140"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a590a68a82624200dcdfdb540a17e2140">appendInfo</a> (<a class="el" href="classmongo_1_1BSONObjBuilder.html">BSONObjBuilder</a> &amp;b) const </td></tr>
<tr class="memdesc:a590a68a82624200dcdfdb540a17e2140"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes information about our cached view of the set to a <a class="el" href="classmongo_1_1BSONObjBuilder.html" title="Utility for creating a BSONObj. ">BSONObjBuilder</a>. <br /></td></tr>
<tr class="separator:a590a68a82624200dcdfdb540a17e2140"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a45b25fc937bf50ebf1156fb60dca5bba"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a45b25fc937bf50ebf1156fb60dca5bba"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a45b25fc937bf50ebf1156fb60dca5bba">isKnownToHaveGoodPrimary</a> () const </td></tr>
<tr class="memdesc:a45b25fc937bf50ebf1156fb60dca5bba"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the monitor knows a usable primary from it's interal view. <br /></td></tr>
<tr class="separator:a45b25fc937bf50ebf1156fb60dca5bba"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c6fe3d573f781d6bfcaf2e048eea024"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1c6fe3d573f781d6bfcaf2e048eea024"></a>
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a1c6fe3d573f781d6bfcaf2e048eea024">ReplicaSetMonitor</a> (const SetStatePtr &amp;initialState)</td></tr>
<tr class="memdesc:a1c6fe3d573f781d6bfcaf2e048eea024"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allows tests to set initial conditions and introspect the current state. <br /></td></tr>
<tr class="separator:a1c6fe3d573f781d6bfcaf2e048eea024"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-methods"></a>
Static Public Member Functions</h2></td></tr>
<tr class="memitem:a18be20771449e391f2c57fe51fa950e0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a18be20771449e391f2c57fe51fa950e0"></a>
static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a18be20771449e391f2c57fe51fa950e0">createIfNeeded</a> (const std::string &amp;name, const std::set&lt; <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &gt; &amp;servers)</td></tr>
<tr class="memdesc:a18be20771449e391f2c57fe51fa950e0"><td class="mdescLeft">&#160;</td><td class="mdescRight">Creates a new <a class="el" href="classmongo_1_1ReplicaSetMonitor.html" title="Holds state about a replica set and provides a means to refresh the local view. ">ReplicaSetMonitor</a>, if it doesn't already exist. <br /></td></tr>
<tr class="separator:a18be20771449e391f2c57fe51fa950e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6a8b6e89e75622725e1311bf98bd4237"><td class="memItemLeft" align="right" valign="top">static ReplicaSetMonitorPtr&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a6a8b6e89e75622725e1311bf98bd4237">get</a> (const std::string &amp;name, bool createFromSeed=false)</td></tr>
<tr class="memdesc:a6a8b6e89e75622725e1311bf98bd4237"><td class="mdescLeft">&#160;</td><td class="mdescRight">gets a cached Monitor per name.  <a href="#a6a8b6e89e75622725e1311bf98bd4237">More...</a><br /></td></tr>
<tr class="separator:a6a8b6e89e75622725e1311bf98bd4237"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb3c92b8fe018dca69e16497fa4eedf9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adb3c92b8fe018dca69e16497fa4eedf9"></a>
static std::set&lt; std::string &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#adb3c92b8fe018dca69e16497fa4eedf9">getAllTrackedSets</a> ()</td></tr>
<tr class="memdesc:adb3c92b8fe018dca69e16497fa4eedf9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns all the currently tracked replica set names. <br /></td></tr>
<tr class="separator:adb3c92b8fe018dca69e16497fa4eedf9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6faa26f9a587475d489f04eda891e4e3"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a6faa26f9a587475d489f04eda891e4e3">remove</a> (const std::string &amp;name, bool clearSeedCache=false)</td></tr>
<tr class="memdesc:a6faa26f9a587475d489f04eda891e4e3"><td class="mdescLeft">&#160;</td><td class="mdescRight">Removes the <a class="el" href="classmongo_1_1ReplicaSetMonitor.html" title="Holds state about a replica set and provides a means to refresh the local view. ">ReplicaSetMonitor</a> for the given set name from _sets, which will delete it.  <a href="#a6faa26f9a587475d489f04eda891e4e3">More...</a><br /></td></tr>
<tr class="separator:a6faa26f9a587475d489f04eda891e4e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a17b056b22f82a5bbd7dfaa8095fa7a29"><td class="memItemLeft" align="right" valign="top">static void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a17b056b22f82a5bbd7dfaa8095fa7a29">setConfigChangeHook</a> (ConfigChangeHook hook)</td></tr>
<tr class="memdesc:a17b056b22f82a5bbd7dfaa8095fa7a29"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sets the hook to be called whenever the config of any replica set changes.  <a href="#a17b056b22f82a5bbd7dfaa8095fa7a29">More...</a><br /></td></tr>
<tr class="separator:a17b056b22f82a5bbd7dfaa8095fa7a29"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa9a458211abfaee543c0a126a2491836"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classmongo_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#aa9a458211abfaee543c0a126a2491836">initialize</a> ()</td></tr>
<tr class="memdesc:aa9a458211abfaee543c0a126a2491836"><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts the ReplicaSetMonitorWatcher.  <a href="#aa9a458211abfaee543c0a126a2491836">More...</a><br /></td></tr>
<tr class="separator:aa9a458211abfaee543c0a126a2491836"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b57d322a494833fde8543d8ba07ea3a"><td class="memItemLeft" align="right" valign="top">static <a class="el" href="classmongo_1_1Status.html">Status</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#a4b57d322a494833fde8543d8ba07ea3a">shutdown</a> (int gracePeriodMillis=0)</td></tr>
<tr class="memdesc:a4b57d322a494833fde8543d8ba07ea3a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Permanently stops all monitoring on replica sets and clears all cached information as well.  <a href="#a4b57d322a494833fde8543d8ba07ea3a">More...</a><br /></td></tr>
<tr class="separator:a4b57d322a494833fde8543d8ba07ea3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-static-attribs"></a>
Static Public Attributes</h2></td></tr>
<tr class="memitem:af6a56db5360943298d7fde841551ebac"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af6a56db5360943298d7fde841551ebac"></a>
static int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#af6a56db5360943298d7fde841551ebac">maxConsecutiveFailedChecks</a></td></tr>
<tr class="memdesc:af6a56db5360943298d7fde841551ebac"><td class="mdescLeft">&#160;</td><td class="mdescRight">If a <a class="el" href="classmongo_1_1ReplicaSetMonitor.html" title="Holds state about a replica set and provides a means to refresh the local view. ">ReplicaSetMonitor</a> has been refreshed more than this many times in a row without finding any live nodes claiming to be in the set, the ReplicaSetMonitorWatcher will stop periodic background refreshes of this set. <br /></td></tr>
<tr class="separator:af6a56db5360943298d7fde841551ebac"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af5619f02277d49a0b17e5864b886da54"><td class="memItemLeft" align="right" valign="top">static bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classmongo_1_1ReplicaSetMonitor.html#af5619f02277d49a0b17e5864b886da54">useDeterministicHostSelection</a></td></tr>
<tr class="memdesc:af5619f02277d49a0b17e5864b886da54"><td class="mdescLeft">&#160;</td><td class="mdescRight">Defaults to false, meaning that if multiple hosts meet a criteria we pick one at random.  <a href="#af5619f02277d49a0b17e5864b886da54">More...</a><br /></td></tr>
<tr class="separator:af5619f02277d49a0b17e5864b886da54"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Holds state about a replica set and provides a means to refresh the local view. </p>
<p>All methods perform the required synchronization to allow callers from multiple threads. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="aa31cc064ed6f97cca5190304bfb47812"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">mongo::ReplicaSetMonitor::ReplicaSetMonitor </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classmongo_1_1StringData.html">StringData</a>&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::set&lt; <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &gt; &amp;&#160;</td>
          <td class="paramname"><em>seeds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializes local state. </p>
<p>seeds must not be empty. </p>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a07049d6895d074584d0e653fb4614a50"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void mongo::ReplicaSetMonitor::failedHost </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &amp;&#160;</td>
          <td class="paramname"><em>host</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Notifies this Monitor that a host has failed and should be considered down. </p>
<p>Call this when you get a connection error. If you get an error while trying to refresh our view of a host, call Refresher::hostFailed() instead. </p>

</div>
</div>
<a class="anchor" id="a6a8b6e89e75622725e1311bf98bd4237"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static ReplicaSetMonitorPtr mongo::ReplicaSetMonitor::get </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>createFromSeed</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>gets a cached Monitor per name. </p>
<p>If the monitor is not found and createFromSeed is false, it will return none. If createFromSeed is true, it will try to look up the last known servers list for this set and will create a new monitor using that as the seed list. </p>

</div>
</div>
<a class="anchor" id="a62b9158339c4762dda3303c0f1d21d42"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> mongo::ReplicaSetMonitor::getHostOrRefresh </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structmongo_1_1ReadPreferenceSetting.html">ReadPreferenceSetting</a> &amp;&#160;</td>
          <td class="paramname"><em>criteria</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a host matching criteria or an empty <a class="el" href="structmongo_1_1HostAndPort.html" title="Name of a process on the network. ">HostAndPort</a> if no host matches. </p>
<p>If no host matches initially, will then attempt to refresh our view of the set by contacting other hosts. May still return no result if no host matches following a refresh. </p>

</div>
</div>
<a class="anchor" id="acc78b4c336cec685a4ca13e00ba0337b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> mongo::ReplicaSetMonitor::getMasterOrUassert </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the host we think is the current master or uasserts. </p>
<p>This is a thin wrapper around getHostOrRefresh so this will also refresh our view if we don't think there is a master at first. The main difference is that this will uassert rather than returning an empty <a class="el" href="structmongo_1_1HostAndPort.html" title="Name of a process on the network. ">HostAndPort</a>. </p>

</div>
</div>
<a class="anchor" id="a7841a80e84632cb2e1b946a277c52520"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">std::string mongo::ReplicaSetMonitor::getServerAddress </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a string with the format name/server1,server2. </p>
<p>If name is empty, returns just comma-separated list of servers. </p>

</div>
</div>
<a class="anchor" id="aa9a458211abfaee543c0a126a2491836"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmongo_1_1Status.html">Status</a> mongo::ReplicaSetMonitor::initialize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Starts the ReplicaSetMonitorWatcher. </p>
<p>You shouldn't have to call this in production code as it is called in init.cpp. However, it may be useful to pair calls to initalize and cleanup in tests. The behavior of other methods in this class is undefined if <a class="el" href="classmongo_1_1ReplicaSetMonitor.html#aa9a458211abfaee543c0a126a2491836" title="Starts the ReplicaSetMonitorWatcher. ">initialize()</a> has not been called. </p>

</div>
</div>
<a class="anchor" id="a59f52b0e9943e3544ccee8c68bb0eea4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool mongo::ReplicaSetMonitor::isPrimary </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structmongo_1_1HostAndPort.html">HostAndPort</a> &amp;&#160;</td>
          <td class="paramname"><em>host</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns true if this node is the master based ONLY on local data. </p>
<p>Be careful, return may be stale. </p>

</div>
</div>
<a class="anchor" id="a6faa26f9a587475d489f04eda891e4e3"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mongo::ReplicaSetMonitor::remove </td>
          <td>(</td>
          <td class="paramtype">const std::string &amp;&#160;</td>
          <td class="paramname"><em>name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>clearSeedCache</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Removes the <a class="el" href="classmongo_1_1ReplicaSetMonitor.html" title="Holds state about a replica set and provides a means to refresh the local view. ">ReplicaSetMonitor</a> for the given set name from _sets, which will delete it. </p>
<p>If clearSeedCache is true, then the cached seed string for this Replica Set will be removed from _seedServers. </p>

</div>
</div>
<a class="anchor" id="a17b056b22f82a5bbd7dfaa8095fa7a29"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static void mongo::ReplicaSetMonitor::setConfigChangeHook </td>
          <td>(</td>
          <td class="paramtype">ConfigChangeHook&#160;</td>
          <td class="paramname"><em>hook</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Sets the hook to be called whenever the config of any replica set changes. </p>
<p>Currently only 1 globally, so this asserts if one already exists.</p>
<p>The hook will be called from a fresh thread. It is responsible for initializing any thread-local state and ensuring that no exceptions escape.</p>
<p>The hook must not be changed while the program has multiple threads. </p>

</div>
</div>
<a class="anchor" id="a4b57d322a494833fde8543d8ba07ea3a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="classmongo_1_1Status.html">Status</a> mongo::ReplicaSetMonitor::shutdown </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gracePeriodMillis</em> = <code>0</code></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Permanently stops all monitoring on replica sets and clears all cached information as well. </p>
<p>As a consequence, NEVER call this if you have other threads that have a <a class="el" href="classmongo_1_1DBClientReplicaSet.html" title="Use this class to connect to a replica set of servers. ">DBClientReplicaSet</a> instance. After this is called, the behavior of other methods in this class is undefined until a subsequent call to initialize.</p>
<p>The gracePeriodMillis parameter determines the maximum amount of time to wait. A value of 0 (the default) indicates no timeout. If a nonzero timeout is specified, a return value of Status::OK() indicates that shutdown completed successfully in the allotted time. </p>

</div>
</div>
<a class="anchor" id="a61b9142e147364322c0868022182777b"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classmongo_1_1ReplicaSetMonitor_1_1Refresher.html">Refresher</a> mongo::ReplicaSetMonitor::startOrContinueRefresh </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a refresher object that can be used to update our view of the set. </p>
<p>If a refresh is currently in-progress, the returned <a class="el" href="classmongo_1_1ReplicaSetMonitor_1_1Refresher.html" title="Refreshes the local view of a replica set. ">Refresher</a> will participate in the current refresh round. </p>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="af5619f02277d49a0b17e5864b886da54"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool mongo::ReplicaSetMonitor::useDeterministicHostSelection</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">static</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Defaults to false, meaning that if multiple hosts meet a criteria we pick one at random. </p>
<p>This is required by the replica set driver spec. Set this to true in tests that need host selection to be deterministic. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>src/mongo/client/<a class="el" href="replica__set__monitor_8h_source.html">replica_set_monitor.h</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.10
</small></address>
</body>
</html>
