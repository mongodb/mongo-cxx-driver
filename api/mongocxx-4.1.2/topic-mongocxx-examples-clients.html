<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MongoDB C++ Driver: Clients</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-extra.css" rel="stylesheet" type="text/css"/>
<!-- patch-apidocs-current-redirects: mongocxx-4.1.2 -->
<link rel="canonical" href="https://mongocxx.org/api/mongocxx-4.1.2/topic-mongocxx-examples-clients.html"/>
<script type="text/javascript">
if (window.location.pathname.startsWith("/api/current/")) {
  window.location.replace(
    window.location.href.replace("/api/current/", "/api/mongocxx-4.1.2/")
  )
}
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">MongoDB C++ Driver<span id="projectnumber">&#160;4.1.2</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',false);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a href="topic-mongocxx.html">The mongocxx Library</a></li><li class="navelem"><a href="topic-mongocxx-examples.html">How-To Guides</a></li>  </ul>
</div>
</div><!-- top -->
<div id="doc-content">
<div><div class="header">
  <div class="headertitle"><div class="title">Clients </div></div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul>
  <li class="level1">
    <a href="#create-a-client">Create a Client </a>
    <ul>
      <li class="level2">
        <a href="#single">Single </a>
        <ul>
          <li class="level3">
            <a href="#basic-usage-6">Basic Usage </a>
          </li>
          <li class="level3">
            <a href="#with-a-custom-uri">With a Custom URI </a>
          </li>
          <li class="level3">
            <a href="#with-client-options">With Client Options </a>
            <ul>
              <li class="level4">
                <a href="#stable-api-options">Stable API Options </a>
              </li>
              <li class="level4">
                <a href="#tls-options">TLS Options </a>
              </li>
              <li class="level4">
                <a href="#automatic-encryption-options">Automatic Encryption Options </a>
              </li>
              <li class="level4">
                <a href="#apm-options">APM Options </a>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="level2">
        <a href="#pool">Pool </a>
        <ul>
          <li class="level3">
            <a href="#basic-usage-7">Basic Usage </a>
          </li>
          <li class="level3">
            <a href="#with-client-options-1">With Client Options </a>
          </li>
          <li class="level3">
            <a href="#try-acquire">Try Acquire </a>
          </li>
        </ul>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#use-a-client">Use a Client </a>
    <ul>
      <li class="level2">
        <a href="#list-databases">List Databases </a>
      </li>
      <li class="level2">
        <a href="#list-databases-with-options">List Databases With Options </a>
      </li>
      <li class="level2">
        <a href="#list-database-names">List Database Names </a>
      </li>
      <li class="level2">
        <a href="#list-database-names-with-options">List Database Names With Options </a>
      </li>
    </ul>
  </li>
  <li class="level1">
    <a href="#error-handling-3">Error Handling </a>
    <ul>
      <li class="level2">
        <a href="#invalid-client">Invalid Client </a>
      </li>
      <li class="level2">
        <a href="#wait-queue-timeout">Wait Queue Timeout </a>
      </li>
      <li class="level2">
        <a href="#invalid-stable-api-options">Invalid Stable API Options </a>
      </li>
      <li class="level2">
        <a href="#tls-not-enabled">TLS Not Enabled </a>
      </li>
      <li class="level2">
        <a href="#invalid-auto-encryption-options">Invalid Auto Encryption Options </a>
      </li>
    </ul>
  </li>
</ul>
</div>
<div class="textblock"><p>How to use clients and client pools.</p>
<h1 class="doxsection"><a class="anchor" id="create-a-client"></a>
Create a Client</h1>
<h2 class="doxsection"><a class="anchor" id="single"></a>
Single</h2>
<h3 class="doxsection"><a class="anchor" id="basic-usage-6"></a>
Basic Usage</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client;</div>
<div class="line"> </div>
<div class="line">        EXPECT(!client);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a>{}};</div>
<div class="line"> </div>
<div class="line">        EXPECT(client);</div>
<div class="line">        EXPECT(client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>().<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>() == <a class="code hl_variable" href="classmongocxx_1_1uri.html#a7b7124c43c8d20fbafd9f8f87f886ca1">mongocxx::uri::k_default_uri</a>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="with-a-custom-uri"></a>
With a Custom URI</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri{<span class="stringliteral">&quot;mongodb://localhost:27017/?appName=example&quot;</span>};</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{uri};</div>
<div class="line"> </div>
<div class="line">    EXPECT(client);</div>
<div class="line">    EXPECT(client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>().<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>() == uri.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>());</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="with-client-options"></a>
With Client Options</h3>
<h4 class="doxsection"><a class="anchor" id="stable-api-options"></a>
Stable API Options</h4>
<div class="fragment"><div class="line"><a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> example() {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1server__api.html">mongocxx::options::server_api</a> server_api_opts{mongocxx::options::server_api::version::k_version_1};</div>
<div class="line"> </div>
<div class="line">    server_api_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1server__api.html#a72db1f19bee620d5f05a3c914d75bbb9">strict</a>(<span class="keyword">true</span>);</div>
<div class="line">    <span class="comment">// ... other Stable API options.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a> client_opts;</div>
<div class="line"> </div>
<div class="line">    client_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#a84009e27f69131cc6e56680c1100f9e5">server_api_opts</a>(server_api_opts);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri;</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{uri, client_opts};</div>
<div class="line"> </div>
<div class="line">    EXPECT(client);</div>
<div class="line">    EXPECT(client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>().<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>() == <a class="code hl_variable" href="classmongocxx_1_1uri.html#a7b7124c43c8d20fbafd9f8f87f886ca1">mongocxx::uri::k_default_uri</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> client;</div>
<div class="line">}</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="tls-options"></a>
TLS Options</h4>
<div class="fragment"><div class="line"><a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> example() {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1tls.html">mongocxx::options::tls</a> tls_opts;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... set TLS options.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a> client_opts;</div>
<div class="line">    client_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#acda9d5ed3db90e3816ee42afe2cda295">tls_opts</a>(tls_opts);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri{<span class="stringliteral">&quot;mongodb://bob:pwd123@localhost:27017/?tls=true&quot;</span>};</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{uri, client_opts};</div>
<div class="line"> </div>
<div class="line">    EXPECT(client);</div>
<div class="line">    EXPECT(client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>().<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>() == uri.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> client;</div>
<div class="line">}</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="automatic-encryption-options"></a>
Automatic Encryption Options</h4>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example(<a class="code hl_class" href="classbsoncxx_1_1v__noabi_1_1document_1_1view.html">bsoncxx::document::view</a> kms_providers) {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html">mongocxx::options::auto_encryption</a> auto_encryption_opts;</div>
<div class="line"> </div>
<div class="line">    auto_encryption_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html#aa84426fa7592c9d596b697599e36771f">key_vault_namespace</a>({<span class="stringliteral">&quot;keyvault&quot;</span>, <span class="stringliteral">&quot;datakeys&quot;</span>});</div>
<div class="line">    auto_encryption_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html#a85573143b79441a75b3717b55f3fb870">kms_providers</a>(kms_providers);</div>
<div class="line">    auto_encryption_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html#aecc47a0eefd7a4197ca8f7fe7ca3c1c6">extra_options</a>(<a class="code hl_function" href="namespacebsoncxx.html#ab0e7628a9514418eee8fbb66a1ec20f6">bsoncxx::from_json</a>(</div>
<div class="line">        R<span class="stringliteral">&quot;({&quot;mongocryptdURI&quot;: &quot;mongodb://localhost:27027&quot;, &quot;mongocryptdSpawnArgs&quot;: [&quot;--port&quot;, &quot;27027&quot;]})&quot;));</span></div>
<div class="line"><span class="stringliteral">    </span><span class="comment">// ... other automatic encryption options.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a> client_opts;</div>
<div class="line">    client_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#a00d52e1719d2c1fc481fcf13237534fc">auto_encryption_opts</a>(auto_encryption_opts);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri;</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{uri, client_opts};</div>
<div class="line"> </div>
<div class="line">    EXPECT(client);</div>
<div class="line">}</div>
</div><!-- fragment --><h4 class="doxsection"><a class="anchor" id="apm-options"></a>
APM Options</h4>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> on_command_started_callback(<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1events_1_1command__started__event.html">mongocxx::events::command_started_event</a> <span class="keyword">const</span>&amp; event);</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1apm.html">mongocxx::options::apm</a> apm_opts;</div>
<div class="line"> </div>
<div class="line">    apm_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1apm.html#ae9b695229e29d616ef6207eb39961148">on_command_started</a>(&amp;on_command_started_callback);</div>
<div class="line">    <span class="comment">// ... other APM options.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a> client_opts;</div>
<div class="line">    client_opts.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#a1d09359b0be206a723b158186ced9605">apm_opts</a>(apm_opts);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a>{}, client_opts};</div>
<div class="line"> </div>
<div class="line">    EXPECT(client);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="pool"></a>
Pool</h2>
<h3 class="doxsection"><a class="anchor" id="basic-usage-7"></a>
Basic Usage</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1pool.html">mongocxx::pool</a> pool;</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1pool_1_1entry.html">mongocxx::pool::entry</a> entry = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a95dff0c5b7ac7b7401a72bbf8ffbf143">acquire</a>();</div>
<div class="line"> </div>
<div class="line">        EXPECT(entry);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a>&amp; client = *entry;</div>
<div class="line"> </div>
<div class="line">        EXPECT(client);</div>
<div class="line">        EXPECT(client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>().<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>() == <a class="code hl_variable" href="classmongocxx_1_1uri.html#a7b7124c43c8d20fbafd9f8f87f886ca1">mongocxx::uri::k_default_uri</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri{<span class="stringliteral">&quot;mongodb://localhost:27017/?appName=example&quot;</span>};</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1pool.html">mongocxx::pool</a> pool{uri};</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1pool_1_1entry.html">mongocxx::pool::entry</a> entry = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a95dff0c5b7ac7b7401a72bbf8ffbf143">acquire</a>();</div>
<div class="line"> </div>
<div class="line">        EXPECT(entry);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a>&amp; client = *entry;</div>
<div class="line"> </div>
<div class="line">        EXPECT(client);</div>
<div class="line">        EXPECT(client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>().<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>() == uri.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>());</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="with-client-options-1"></a>
With Client Options</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a> client_opts;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ... set client options.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri;</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1pool.html">mongocxx::pool</a> pool{uri, <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1pool.html">mongocxx::options::pool</a>{client_opts}};</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1pool_1_1entry.html">mongocxx::pool::entry</a> entry = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a95dff0c5b7ac7b7401a72bbf8ffbf143">acquire</a>();</div>
<div class="line"> </div>
<div class="line">    EXPECT(entry);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a>&amp; client = *entry;</div>
<div class="line"> </div>
<div class="line">    EXPECT(client);</div>
<div class="line">    EXPECT(client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>().<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1uri.html#a5e0de7d52153d6bf87adb3e6bd76ee6a">to_string</a>() == <a class="code hl_variable" href="classmongocxx_1_1uri.html#a7b7124c43c8d20fbafd9f8f87f886ca1">mongocxx::uri::k_default_uri</a>);</div>
<div class="line">}</div>
</div><!-- fragment --><h3 class="doxsection"><a class="anchor" id="try-acquire"></a>
Try Acquire</h3>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri{<span class="stringliteral">&quot;mongodb://localhost:27017/?maxPoolSize=1&amp;waitQueueTimeoutMS=1&quot;</span>};</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1pool.html">mongocxx::pool</a> pool{uri};</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> entry_opt = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a5a22cb22f709d96e52f75f2ab5c97ad2">try_acquire</a>();</div>
<div class="line"> </div>
<div class="line">    EXPECT(entry_opt);</div>
<div class="line">    EXPECT(*entry_opt);</div>
<div class="line"> </div>
<div class="line">    {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1pool_1_1entry.html">mongocxx::pool::entry</a> hold = std::move(*entry_opt);</div>
<div class="line"> </div>
<div class="line">        EXPECT(hold);</div>
<div class="line"> </div>
<div class="line">        entry_opt = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a5a22cb22f709d96e52f75f2ab5c97ad2">try_acquire</a>();</div>
<div class="line"> </div>
<div class="line">        EXPECT(!entry_opt);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    entry_opt = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a5a22cb22f709d96e52f75f2ab5c97ad2">try_acquire</a>();</div>
<div class="line"> </div>
<div class="line">    EXPECT(entry_opt);</div>
<div class="line">    EXPECT(*entry_opt);</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="use-a-client"></a>
Use a Client</h1>
<h2 class="doxsection"><a class="anchor" id="list-databases"></a>
List Databases</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example(<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client) {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1cursor.html">mongocxx::cursor</a> databases = client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#aaf98649073a03bc33e4fd0fc4e456332">list_databases</a>();</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> count = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_class" href="classbsoncxx_1_1v__noabi_1_1document_1_1view.html">bsoncxx::document::view</a> doc : databases) {</div>
<div class="line">        EXPECT(doc[<span class="stringliteral">&quot;name&quot;</span>]);</div>
<div class="line">        EXPECT(doc[<span class="stringliteral">&quot;sizeOnDisk&quot;</span>]);</div>
<div class="line">        EXPECT(doc[<span class="stringliteral">&quot;empty&quot;</span>]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (doc[<span class="stringliteral">&quot;name&quot;</span>].get_string().value == <span class="stringliteral">&quot;admin&quot;</span>) {</div>
<div class="line">            ++count;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    EXPECT(count == 1);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="list-databases-with-options"></a>
List Databases With Options</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example(<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client) {</div>
<div class="line">    <span class="keyword">auto</span> opts = <a class="code hl_function" href="namespacebsoncxx.html#ab0e7628a9514418eee8fbb66a1ec20f6">bsoncxx::from_json</a>(R<span class="stringliteral">&quot;({&quot;nameOnly&quot;: true})&quot;);</span></div>
<div class="line"><span class="stringliteral">    </span><span class="comment">// ... other listDatabases options.</span></div>
<div class="line"> </div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1cursor.html">mongocxx::cursor</a> databases = client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#aaf98649073a03bc33e4fd0fc4e456332">list_databases</a>(opts.view());</div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">int</span> count = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (<a class="code hl_class" href="classbsoncxx_1_1v__noabi_1_1document_1_1view.html">bsoncxx::document::view</a> doc : databases) {</div>
<div class="line">        EXPECT(doc[<span class="stringliteral">&quot;name&quot;</span>]);</div>
<div class="line">        EXPECT(!doc[<span class="stringliteral">&quot;sizeOnDisk&quot;</span>]);</div>
<div class="line">        EXPECT(!doc[<span class="stringliteral">&quot;empty&quot;</span>]);</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (doc[<span class="stringliteral">&quot;name&quot;</span>].get_string().value == <span class="stringliteral">&quot;admin&quot;</span>) {</div>
<div class="line">            ++count;</div>
<div class="line">        }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    EXPECT(count == 1);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="list-database-names"></a>
List Database Names</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example(<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client) {</div>
<div class="line">    std::vector&lt;std::string&gt; names = client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a394afade3289e91b2ebcb007ab6b012d">list_database_names</a>();</div>
<div class="line"> </div>
<div class="line">    EXPECT(std::count(names.begin(), names.end(), <span class="stringliteral">&quot;admin&quot;</span>) == 1);</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="list-database-names-with-options"></a>
List Database Names With Options</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example(<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client) {</div>
<div class="line">    <span class="keyword">auto</span> opts = <a class="code hl_function" href="namespacebsoncxx.html#ab0e7628a9514418eee8fbb66a1ec20f6">bsoncxx::from_json</a>(R<span class="stringliteral">&quot;({&quot;authorizedDatabases&quot;: true})&quot;);</span></div>
<div class="line"><span class="stringliteral">    </span><span class="comment">// ... other listDatabases options.</span></div>
<div class="line"> </div>
<div class="line">    std::vector&lt;std::string&gt; names = client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a394afade3289e91b2ebcb007ab6b012d">list_database_names</a>(opts.view());</div>
<div class="line"> </div>
<div class="line">    EXPECT(std::count(names.begin(), names.end(), <span class="stringliteral">&quot;admin&quot;</span>) == 0);</div>
<div class="line">}</div>
</div><!-- fragment --><h1 class="doxsection"><a class="anchor" id="error-handling-3"></a>
Error Handling</h1>
<h2 class="doxsection"><a class="anchor" id="invalid-client"></a>
Invalid Client</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client;</div>
<div class="line"> </div>
<div class="line">    EXPECT(!client);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a> uri = client.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1client.html#a067bce0c0da5f3c0d4d3fa68d724acb9">uri</a>(); <span class="comment">// DO NOT DO THIS. Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        EXPECT(ex.code() == mongocxx::error_code::k_invalid_client_object);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="wait-queue-timeout"></a>
Wait Queue Timeout</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1pool.html">mongocxx::pool</a> pool{<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a>{<span class="stringliteral">&quot;mongodb://localhost:27017/?maxPoolSize=1&amp;waitQueueTimeoutMS=1&quot;</span>}};</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1pool_1_1entry.html">mongocxx::pool::entry</a> hold = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a95dff0c5b7ac7b7401a72bbf8ffbf143">acquire</a>();</div>
<div class="line"> </div>
<div class="line">        EXPECT(hold);</div>
<div class="line"> </div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1pool_1_1entry.html">mongocxx::pool::entry</a> entry = pool.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1pool.html#a95dff0c5b7ac7b7401a72bbf8ffbf143">acquire</a>(); <span class="comment">// Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        EXPECT(ex.code() == mongocxx::error_code::k_pool_wait_queue_timeout);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="invalid-stable-api-options"></a>
Invalid Stable API Options</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_enumeration" href="classmongocxx_1_1options_1_1server__api.html#a340d8119e4418476fc178968bae82d4e">mongocxx::options::server_api::version</a> version =</div>
<div class="line">            <a class="code hl_function" href="classmongocxx_1_1options_1_1server__api.html#a0968a7c07b5daefdc6f15dcb16da37c6">mongocxx::options::server_api::version_from_string</a>(<span class="stringliteral">&quot;0&quot;</span>); <span class="comment">// Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        EXPECT(ex.code() == mongocxx::error_code::k_invalid_parameter);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        std::string version = <a class="code hl_function" href="classmongocxx_1_1options_1_1server__api.html#a0a7b4c4471936e8418b6a569003b2790">mongocxx::options::server_api::version_to_string</a>(</div>
<div class="line">            <span class="keyword">static_cast&lt;</span><a class="code hl_enumeration" href="classmongocxx_1_1options_1_1server__api.html#a340d8119e4418476fc178968bae82d4e">mongocxx::options::server_api::version</a><span class="keyword">&gt;</span>(1)); <span class="comment">// Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        EXPECT(ex.code() == mongocxx::error_code::k_invalid_parameter);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="tls-not-enabled"></a>
TLS Not Enabled</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{</div>
<div class="line">            <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a>{}, <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a>{}.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#acda9d5ed3db90e3816ee42afe2cda295">tls_opts</a>(<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1tls.html">mongocxx::options::tls</a>{})}; <span class="comment">// Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        EXPECT(</div>
<div class="line">            <span class="comment">// When TLS/SSL is enabled for both mongocxx and libmongoc.</span></div>
<div class="line">            ex.code() == mongocxx::error_code::k_invalid_parameter ||</div>
<div class="line"> </div>
<div class="line">            <span class="comment">// When TLS/SSL is not enabled for either mongocxx or libmongoc.</span></div>
<div class="line">            ex.code() == mongocxx::error_code::k_ssl_not_supported ||</div>
<div class="line"> </div>
<div class="line">            <span class="keyword">false</span>);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --><h2 class="doxsection"><a class="anchor" id="invalid-auto-encryption-options"></a>
Invalid Auto Encryption Options</h2>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> example() {</div>
<div class="line">    <span class="comment">// Missing keyvault namespace.</span></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{</div>
<div class="line">            <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a>{},</div>
<div class="line">            <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a>{}.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#a00d52e1719d2c1fc481fcf13237534fc">auto_encryption_opts</a>(<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html">mongocxx::options::auto_encryption</a>{})}; <span class="comment">// Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        <span class="comment">// CXX-834: libmongoc error code.</span></div>
<div class="line">        EXPECT(ex.code().category() == <a class="code hl_function" href="namespacemongocxx.html#aae348e2420ad9d91523f0bd723d078d4">mongocxx::server_error_category</a>());</div>
<div class="line">        EXPECT(ex.code().value() == 58); <span class="comment">// MONGOC_ERROR_CLIENT_INVALID_ENCRYPTION_ARG</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Invalid KMS providers.</span></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{</div>
<div class="line">            <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a>{},</div>
<div class="line">            <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a>{}.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#a00d52e1719d2c1fc481fcf13237534fc">auto_encryption_opts</a>(</div>
<div class="line">                <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html">mongocxx::options::auto_encryption</a>{}</div>
<div class="line">                    .<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html#aa84426fa7592c9d596b697599e36771f">key_vault_namespace</a>({<span class="stringliteral">&quot;keyvault&quot;</span>, <span class="stringliteral">&quot;datakeys&quot;</span>})</div>
<div class="line">                    .<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html#a85573143b79441a75b3717b55f3fb870">kms_providers</a>(<a class="code hl_function" href="namespacebsoncxx.html#ab0e7628a9514418eee8fbb66a1ec20f6">bsoncxx::from_json</a>(R<span class="stringliteral">&quot;({&quot;invalid&quot;: 1})&quot;)))}; </span><span class="comment">// Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        <span class="comment">// CXX-834: libmongocrypt error code.</span></div>
<div class="line">        EXPECT(ex.code().category() == <a class="code hl_function" href="namespacemongocxx.html#aae348e2420ad9d91523f0bd723d078d4">mongocxx::server_error_category</a>());</div>
<div class="line">        EXPECT(ex.code().value() == 1); <span class="comment">// MONGOCRYPT_GENERIC_ERROR_CODE</span></div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Incompatible options.</span></div>
<div class="line">    <span class="keywordflow">try</span> {</div>
<div class="line">        <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1client.html">mongocxx::client</a> client{</div>
<div class="line">            <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1uri.html">mongocxx::uri</a>{},</div>
<div class="line">            <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html">mongocxx::options::client</a>{}.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1client.html#a00d52e1719d2c1fc481fcf13237534fc">auto_encryption_opts</a>(</div>
<div class="line">                <a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html">mongocxx::options::auto_encryption</a>{}.<a class="code hl_function" href="classmongocxx_1_1v__noabi_1_1options_1_1auto__encryption.html#a4d1642378c261cbff8d0bc7787e06d31">key_vault_client</a>(<span class="keyword">nullptr</span>).key_vault_pool(<span class="keyword">nullptr</span>))}; <span class="comment">// Throws.</span></div>
<div class="line"> </div>
<div class="line">        EXPECT(<span class="keyword">false</span> &amp;&amp; <span class="stringliteral">&quot;should not reach this point&quot;</span>);</div>
<div class="line">    } <span class="keywordflow">catch</span> (<a class="code hl_class" href="classmongocxx_1_1v__noabi_1_1exception.html">mongocxx::exception</a> <span class="keyword">const</span>&amp; ex) {</div>
<div class="line">        EXPECT(ex.code() == mongocxx::error_code::k_invalid_parameter);</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment -->   </div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0
</small></address>
</div><!-- doc-content -->
</body>
</html>
