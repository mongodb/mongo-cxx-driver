<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">
<meta name="keyword" content="">
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">

    <link rel="shortcut icon" href="https://mongocxx.org/img/favicon.png">

    <title>Legacy driver tutorial</title>

    <link rel="stylesheet" href="https://mongocxx.org/lib/bootstrap.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/lib/font-awesome/css/font-awesome.min.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/css/mongodb-docs.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/css/overrides.css" type="text/css" />
<link rel="stylesheet" href="https://mongocxx.org/lib/highlight/styles/idea.css" />

  </head>

  <body>
  
  <section id="container" class="">
      
      <header id="header-db" class="row" role="navigation">
  <div class="header-content">
    <div class="toggle-nav pull-left">
        <i class="fa fa-bars"></i>
        <div class="icon-reorder tooltips" data-original-title="Toggle Navigation" data-placement="bottom"></div>
    </div>
    
    <div class="logo pull-left">
      <a href="https://mongocxx.org/">
        <img src="https://mongocxx.org/img/logo-mongodb-header.png",
             alt="MongoDB C++ driver" />
      </a>
    </div>
    
    <div>
<div class="nav-items pull-right">
  <div id="search">
<form method="get" action="//www.google.com/search" target="_blank">
    <input type="text" name="searchQuery" size="20" value="" autocomplete="off" placeholder="Search">
    <input type="hidden" name="site" value="https://mongocxx.org/">
    <input type="hidden" name="q" value="">
    <label for="searchQuery"><i class="fa fa-search fa-1"></i></label>
</form>
</div>

</div>
</div>

  </div>
</header>

      

      
<aside id="sidebar" class="sidebar">
    <div class="ssidebar nav-collapse">
      <div class="ssidebarwrapper">
        <h3>
          <a class="index-link" href="https://mongocxx.org/">MongoDB C&#43;&#43; Driver Manual</a>
        </h3>

        
        <ul class="sidebar-menu">
          
          
          
          
          
          
          
          
          
          
          
          

          
          
            
            









  
    
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  


        
          
        
      
    
      
      
        
        
        
        
        
        
        
        









  
  
  
  
  
  
  
  

  
    
    
    
  
  


        
      
    
      
      
        
      
    
      
      
    
      
      
    
    
  


          
            
            









  


          
            
            









  


          
            
            









  


          

          

          
            
            













  




<li class="toctree-l1  current">
  <a href="/legacy-v1/" class="">
      <i class='fa fa-arrow-right'></i>
      <span>legacy (v1)</span>
      <span class="menu-arrow fa fa-angle-down"></span>
  </a>
    <ul  class="current">
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/installation/">
        
        Installing the legacy driver
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/configuration/">
        
        Configuring the legacy driver
    </a>
  </li>


        
        
        
        
        













  




    <li class="toctree-l2">
    <a href="/legacy-v1/tutorial/">
        
        Legacy driver tutorial
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/working-with-bson/">
        
        Working with BSON
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/breaking-changes/">
        
        Breaking changes from 26compat
    </a>
  </li>


        
        
        
        
        
















    <li class="toctree-l2">
    <a href="/legacy-v1/">
        
        The Legacy C&#43;&#43; Driver
    </a>
  </li>


        
        
    </ul>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://mongocxx.org/api/current/">
        <i class='fa fa-book'></i>
        API Documentation
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="https://github.com/mongodb/mongo-cxx-driver/">
        <i class='fa fa-github'></i>
        Source Code
    </a>
  </li>


          
            
            
















    <li class="toctree-l1">
    <a href="/contributing/">
        <i class='fa fa-pencil'></i>
        Contributing
    </a>
  </li>


          
        </ul>
        
    </div>
  </div>
  

</aside>



      
      <section id="main-content" class="content">
          <section class="main-column pull-left">
            <div class="document">
              <div class="documentwrapper">
                <div class="bodywrapper">
                  <div class="body">


   
<a class="edit-link" href="https://github.com/mongodb/mongo-cxx-driver/blob/master/docs/content/legacy-v1/tutorial.md" target="_blank" title="Edit legacy-v1/tutorial.md on GitHub"><i class="fa fa-pencil-square-o"></i></a>










<div class="bc">
<ul>
  
  
  
  
  
  <li><a href="/legacy-v1/">legacy (v1)</a> <i class="fa fa-angle-right"></i></li>
  <li>Legacy driver tutorial</li>
</ul>
</div>


<h1>Legacy driver tutorial</h1>
<em>The Legacy C++ driver has reached End-Of-Life. Please upgrade to the mongocxx driver.</em>
<h3 id="getting-started-with-the-legacy-c-driver">Getting started with the Legacy C++ Driver</h3>
<p>This is an introduction to usage of the MongoDB database from a C++ program.</p>
<p>NOTE: this tutorial is for the legacy and 26compat versions of the C++ driver.</p>
<p>First, install MongoDB – see the
<a href="https://www.mongodb.com/docs/manual/installation/">installation</a> page for
details.</p>
<p>Next, you may wish to take a look at the <a href="https://www.mongodb.com/docs/manual/">MongoDB
Manual</a> for a language independent look at
how to use MongoDB. Also, we suggest some basic familiarity with the <a href="https://www.mongodb.com/docs/mongodb-shell/">mongo
shell</a> – the shell is the primary
database administration tool and is useful for manually inspecting the
contents of a database after your C++ program runs.</p>
<h3 id="installing-the-driver-library-and-headers">Installing the Driver Library and Headers</h3>
<p>Please see <a href="https://mongocxx.org/legacy-v1/installation/">Installation</a> for
instructions on how to download, build, and install the C++ client driver.</p>
<h3 id="initializing-the-driver-library">Initializing the Driver Library</h3>
<p>Please see <a href="https://mongocxx.org/legacy-v1/configuration/">Configuration</a> for
instructions on how to properly initialize and terminate the driver:</p>
<h3 id="connecting">Connecting</h3>
<h4 id="dbclientconnection">DBClientConnection</h4>
<p>The C++ driver includes several classes for managing collections under the parent class <code>DBClientInterface</code>.</p>
<ul>
<li><code>DBClientConnection</code> is the connection class for connecting to a single MongoDB database server (or mongos)</li>
<li><code>DBClientReplicaSet</code> is the connection class for connecting to a replica set.</li>
</ul>
<p>See the <a href="https://mongodb.github.io/api/1.0.2/">API documentation</a> for
details on each of the above classes.</p>
<h4 id="a-simple-program-that-connects-to-the-database">A simple program that connects to the database</h4>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;cstdlib&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;iostream&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&#34;mongo/client/dbclient.h&#34;</span><span style="color:#75715e"> </span><span style="color:#75715e">// for the driver
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">run</span>() {
</span></span><span style="display:flex;"><span>  mongo<span style="color:#f92672">::</span>DBClientConnection c;
</span></span><span style="display:flex;"><span>  c.connect(<span style="color:#e6db74">&#34;localhost&#34;</span>);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    mongo<span style="color:#f92672">::</span>client<span style="color:#f92672">::</span>initialize();
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">try</span> {
</span></span><span style="display:flex;"><span>        run();
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;connected ok&#34;</span> <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    } <span style="color:#66d9ef">catch</span>( <span style="color:#66d9ef">const</span> mongo<span style="color:#f92672">::</span>DBException <span style="color:#f92672">&amp;</span>e ) {
</span></span><span style="display:flex;"><span>        std<span style="color:#f92672">::</span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;caught &#34;</span> <span style="color:#f92672">&lt;&lt;</span> e.what() <span style="color:#f92672">&lt;&lt;</span> std<span style="color:#f92672">::</span>endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> EXIT_SUCCESS;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>(Note that in a production environment, the return value of <code>mongo::client::initialize()</code> must be checked)</p>
<p>If you are using gcc on Linux, you would compile with something like this, depending on location of your include files and libraries:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-sh" data-lang="sh"><span style="display:flex;"><span>$ g++ tutorial.cpp -pthread -lmongoclient -lboost_thread-mt -lboost_system -lboost_regex -o tutorial
</span></span><span style="display:flex;"><span>$ ./tutorial
</span></span><span style="display:flex;"><span>connected ok
</span></span></code></pre></div><blockquote>
<p><strong>Warning</strong></p>
</blockquote>
<ul>
<li>Since the tutorial program attempts to connect to a MongoDB database server, you must start it by running mongod before running the tutorial.</li>
<li>You may need to append -mt to boost_filesystem and boost_program_options. If using a recent boost, -mt is not needed anymore.</li>
<li>You may need to use -I and -L to specify the locations of your mongo and boost headers and libraries.</li>
<li>If using the 26compat branch you need to additionally specify <code>-lboost_filesystem</code> and <code>-lboost_program_options</code></li>
</ul>
<h3 id="bson">BSON</h3>
<p>The MongoDB database stores data in BSON format. BSON is a binary object
format that is JSON-like in terms of the data which can be stored (some
extensions exist, for example, a Date datatype).</p>
<p>To save data in the database we must create objects of class BSONObj. The
components of a BSONObj are represented as BSONElement objects. We use
BSONObjBuilder to make BSON objects, and BSONObjIterator to enumerate BSON
objects.</p>
<h4 id="the-c-bson-library">The C++ BSON Library</h4>
<p>Include bson/bson.h in your application. See
<a href="https://github.com/mongodb/mongo-cxx-driver/blob/legacy/src/mongo/bson/bsondemo/bsondemo.cpp">bsondemo</a>
for example usage.</p>
<h5 id="key-classes">Key classes</h5>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>mongo<span style="color:#f92672">::</span>BSONObj: a BSON object
</span></span><span style="display:flex;"><span>mongo<span style="color:#f92672">::</span>BSONElement: a single element in a BSON object. This is a key and a value.
</span></span><span style="display:flex;"><span>mongo<span style="color:#f92672">::</span>BSONObjBuilder: used to make BSON objects
</span></span><span style="display:flex;"><span>mongo<span style="color:#f92672">::</span>BSONObjIterator: used to enumerate BSON objects
</span></span></code></pre></div><h5 id="working-with-bson">Working with BSON</h5>
<p>Let’s now create a BSON “person” object which contains name and age. We might invoke:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONObjBuilder b;
</span></span><span style="display:flex;"><span>b.append(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;Joe&#34;</span>);
</span></span><span style="display:flex;"><span>b.append(<span style="color:#e6db74">&#34;age&#34;</span>, <span style="color:#ae81ff">33</span>);
</span></span><span style="display:flex;"><span>BSONObj p <span style="color:#f92672">=</span> b.obj();
</span></span></code></pre></div><p>Or more concisely:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONObj p <span style="color:#f92672">=</span> BSONObjBuilder().append(<span style="color:#e6db74">&#34;name&#34;</span>, <span style="color:#e6db74">&#34;Joe&#34;</span>).append(<span style="color:#e6db74">&#34;age&#34;</span>, <span style="color:#ae81ff">33</span>).obj();
</span></span></code></pre></div><p>We can also create BSON objects using the stream oriented syntax:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONObjBuilder b;
</span></span><span style="display:flex;"><span>b <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Joe&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">33</span>;
</span></span><span style="display:flex;"><span>BSONObj p <span style="color:#f92672">=</span> b.obj();
</span></span></code></pre></div><p>The BSON Macro lets us be even more compact:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONObj p <span style="color:#f92672">=</span> BSON( <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Joe&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">33</span> );
</span></span></code></pre></div><p>Use the GENOID helper to add an object id to your object. The server will
add an _id automatically if it is not included explicitly.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONObj p <span style="color:#f92672">=</span> BSON( GENOID <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Joe&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">33</span> );
</span></span><span style="display:flex;"><span><span style="color:#75715e">// result is: { _id : ..., name : &#34;Joe&#34;, age : 33 }
</span></span></span></code></pre></div><p>GENOID should be at the beginning of the generated object. We can do something similar with the non-stream builder syntax:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONObj p <span style="color:#f92672">=</span> BSONObjBuilder().genOID().append(<span style="color:#e6db74">&#34;name&#34;</span>,<span style="color:#e6db74">&#34;Joe&#34;</span>).append(<span style="color:#e6db74">&#34;age&#34;</span>,<span style="color:#ae81ff">33</span>).obj();
</span></span></code></pre></div><p>Other helpers are listed in <a href="https://mongocxx.org/legacy-v1/working-with-bson/">Working with BSON</a>.</p>
<h3 id="inserting">Inserting</h3>
<p>We now save our person object in a persons collection in the database:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>c.insert(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>, p);
</span></span></code></pre></div><p>The first parameter to insert is the namespace. tutorial is the database and persons is the collection name.</p>
<h4 id="getlasterror">getLastError</h4>
<p>In order to ensure the write succeeded we need to call getLastError.</p>
<p>Get error result from the last operation on this connection:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>string mongo<span style="color:#f92672">::</span>DBClientWithCommands<span style="color:#f92672">::</span>getLastError(); <span style="color:#75715e">// Empty string if no error
</span></span></span></code></pre></div><p>Get the full last error object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONObj DBClientWithCommands<span style="color:#f92672">::</span>getLastErrorDetailed();
</span></span></code></pre></div><p>For an example, see <a href="https://github.com/mongodb/mongo-cxx-driver/blob/legacy/src/mongo/client/examples/simple_client_demo.cpp">this demo</a>.</p>
<p>For additional background information on getLastError see the <a href="https://www.mongodb.com/docs/manual/core/write-operations/#write-concern">write
operations documentation</a>.</p>
<h3 id="count">Count</h3>
<p>Let’s now fetch all objects from the persons collection, and display them. We’ll also show here how to use count().</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;count:&#34;</span> <span style="color:#f92672">&lt;&lt;</span> c.count(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>) <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span></code></pre></div><h3 id="query">Query</h3>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>auto_ptr<span style="color:#f92672">&lt;</span>DBClientCursor<span style="color:#f92672">&gt;</span> cursor <span style="color:#f92672">=</span> c.query(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>, BSONObj());
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">while</span> (cursor<span style="color:#f92672">-&gt;</span>more())
</span></span><span style="display:flex;"><span>   cout <span style="color:#f92672">&lt;&lt;</span> cursor<span style="color:#f92672">-&gt;</span>next().toString() <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span></code></pre></div><p><code>BSONObj()</code> is an empty BSON object – it represents <code>{}</code> which indicates an
empty query pattern (an empty query is a query for all objects).</p>
<p>We use <code>BSONObj::toString()</code> above to print out information about each
object retrieved. <code>BSONObj::toString</code> is a diagnostic function which prints
an abbreviated JSON string representation of the object. For full JSON
output, use <code>BSONObj::jsonString</code>.</p>
<p>Let’s now write a function which prints out the name (only) of all persons
in the collection whose age is a given value:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">printIfAge</span>(DBClientConnection<span style="color:#f92672">&amp;</span> c, <span style="color:#66d9ef">int</span> age) {
</span></span><span style="display:flex;"><span>    auto_ptr<span style="color:#f92672">&lt;</span>DBClientCursor<span style="color:#f92672">&gt;</span> cursor <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>        c.query(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>, MONGO_QUERY(<span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> age));
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">while</span> (cursor<span style="color:#f92672">-&gt;</span>more()) {
</span></span><span style="display:flex;"><span>        BSONObj p <span style="color:#f92672">=</span> cursor<span style="color:#f92672">-&gt;</span>next();
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> p.getStringField(<span style="color:#e6db74">&#34;name&#34;</span>) <span style="color:#f92672">&lt;&lt;</span> endl;
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><code>getStringField()</code> is a helper that assumes the name field is of type
string. To manipulate an element in a more generic fashion we can retrieve
the particular BSONElement from the enclosing object:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>BSONElement name <span style="color:#f92672">=</span> p[<span style="color:#e6db74">&#34;name&#34;</span>];
</span></span><span style="display:flex;"><span><span style="color:#75715e">// or:
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>BSONElement name <span style="color:#f92672">=</span> p.getField(<span style="color:#e6db74">&#34;name&#34;</span>);
</span></span></code></pre></div><p>See the api docs, and jsobj.h, for more information.</p>
<p>Our query above, written as JSON, is of the form</p>
<p><code>{ age : &lt;agevalue&gt; }</code></p>
<p>Queries are BSON objects of a particular format – in fact, we could have
used the BSON() macro above instead of MONGO_QUERY(). See class Query in
dbclient.h for more information on Query objects, and the Sorting section
below.</p>
<p>In the mongo shell (which uses javascript), we could invoke:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">use</span> <span style="color:#a6e22e">tutorial</span>;
</span></span><span style="display:flex;"><span><span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">persons</span>.<span style="color:#a6e22e">find</span>({<span style="color:#a6e22e">age</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">33</span>});
</span></span></code></pre></div><h3 id="indexing">Indexing</h3>
<p>Let’s suppose we want to have an index on age so that our queries are fast. We would use:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>c.createIndex(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>, fromjson(<span style="color:#e6db74">&#34;{age:1}&#34;</span>));
</span></span></code></pre></div><p>In the above example we use a new function, fromjson. fromjson converts a
JSON string to a BSONObj. This is sometimes a convenient way to specify
BSON. Alternatively, we could have written:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>c.createIndex(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>, BSON( <span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span> ));
</span></span></code></pre></div><p>While calling createIndex multiple times won&rsquo;t result in duplicate index
creation on the server, it will cause an extra network round-trip and
server operation for each call. It&rsquo;s best practice to use this method
sparingly, for example once at the beginning of your code, or perhaps in an
external setup script that configures the database for your application.
For more information about indexing, see the <a href="https://www.mongodb.com/docs/manual/indexes/">MongoDB Indexing
docs</a>.</p>
<h3 id="sorting">Sorting</h3>
<p>Let’s now make the results from printIfAge sorted alphabetically by name.
To do this, we change the query statement from:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>auto_ptr<span style="color:#f92672">&lt;</span>DBClientCursor<span style="color:#f92672">&gt;</span> cursor <span style="color:#f92672">=</span> c.query(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>, MONGO_QUERY(<span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> age));
</span></span></code></pre></div><p>to</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>auto_ptr<span style="color:#f92672">&lt;</span>DBClientCursor<span style="color:#f92672">&gt;</span> cursor <span style="color:#f92672">=</span> c.query(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>, MONGO_QUERY(<span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> age ).sort(<span style="color:#e6db74">&#34;name&#34;</span>));
</span></span></code></pre></div><p>Here we have used <code>Query::sort()</code> to add a modifier to our query expression for sorting.</p>
<h3 id="updating">Updating</h3>
<p>Use the <code>update()</code> method to perform a database update. For example the
following update in the mongo shell:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">use</span> <span style="color:#a6e22e">tutorial</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&gt;</span> <span style="color:#a6e22e">db</span>.<span style="color:#a6e22e">persons</span>.<span style="color:#a6e22e">update</span>(
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">name</span> <span style="color:#f92672">:</span> <span style="color:#e6db74">&#39;Joe&#39;</span>, <span style="color:#a6e22e">age</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">33</span> },
</span></span><span style="display:flex;"><span>    { <span style="color:#a6e22e">$inc</span> <span style="color:#f92672">:</span> { <span style="color:#a6e22e">visits</span> <span style="color:#f92672">:</span> <span style="color:#ae81ff">1</span> } }
</span></span><span style="display:flex;"><span>)
</span></span></code></pre></div><p>is equivalent to the following C++ code:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>db.update(<span style="color:#e6db74">&#34;tutorial.persons&#34;</span>,
</span></span><span style="display:flex;"><span>    BSON(<span style="color:#e6db74">&#34;name&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Joe&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;age&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">33</span>),
</span></span><span style="display:flex;"><span>    BSON(<span style="color:#e6db74">&#34;$inc&#34;</span> <span style="color:#f92672">&lt;&lt;</span> BSON( <span style="color:#e6db74">&#34;visits&#34;</span> <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>);
</span></span></code></pre></div><p>The <code>update()</code> method can be used to modify specific fields, replace the
entire existing document, insert new documents or update multiple
documents.  In the MongoDB Manual, examples are provided in the <a href="https://www.mongodb.com/docs/manual/tutorial/modify-documents/">Modify
Documents Tutorial</a>.</p>
<h3 id="arrays">Arrays</h3>
<p>A simple example illustrating usage of BSON arrays and the <code>$nin</code> operator
is available <a href="https://github.com/mongodb/mongo-cxx-driver/blob/legacy/src/mongo/client/examples/arrayExample.cpp">here</a>.</p>
<h3 id="further-reading">Further Reading</h3>
<p>This overview just touches on the basics of using MongoDB from C++. There
are many more capabilities. For further exploration:</p>
<ul>
<li>See the language-independent <a href="https://www.mongodb.com/docs/manual/">MongoDB Manual</a></li>
<li>Experiment with the <a href="https://www.mongodb.com/docs/mongodb-shell/">mongo shell</a></li>
<li>Review the <a href="https://mongodb.github.io/api/1.0.2">API docs</a></li>
</ul>






<div id="btnv">
  
  <div class="pull-left">
  <a class="navigation prev" href="/legacy-v1/configuration/">
      <i class="fa fa-long-arrow-left"> </i> Configuring the legacy driver
  </a>
  </div>
  
  
  <div class="pull-right">
  <a class="navigation next" href="/legacy-v1/working-with-bson/">
    Working with BSON <i class="fa fa-long-arrow-right"> </i>
  </a>
  
</div>
</div>


</div>
<div class="right-column">
<div class="wrapper">
  
  <div class="toc">
    <span class="toc-header">On this page</span>
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#getting-started-with-the-legacy-c-driver">Getting started with the Legacy C++ Driver</a></li>
        <li><a href="#installing-the-driver-library-and-headers">Installing the Driver Library and Headers</a></li>
        <li><a href="#initializing-the-driver-library">Initializing the Driver Library</a></li>
        <li><a href="#connecting">Connecting</a></li>
        <li><a href="#bson">BSON</a></li>
        <li><a href="#inserting">Inserting</a></li>
        <li><a href="#count">Count</a></li>
        <li><a href="#query">Query</a></li>
        <li><a href="#indexing">Indexing</a></li>
        <li><a href="#sorting">Sorting</a></li>
        <li><a href="#updating">Updating</a></li>
        <li><a href="#arrays">Arrays</a></li>
        <li><a href="#further-reading">Further Reading</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
  
</div>
</div>

</div>
</div>
</div>
</section>
</section>

</section>


<script type="text/javascript">
  var DOCUMENTATION_OPTIONS = {
   URL_ROOT:    "https://mongocxx.org/",
   VERSION:      null ,
   COLLAPSE_INDEX: false,
   FILE_SUFFIX: '.html',
   HAS_SOURCE:  true
  };
</script>
<script type="text/javascript" src="https://mongocxx.org/js/jquery.js"></script>
<script type="text/javascript" src="https://mongocxx.org/lib/bootstrap.js"></script>
<script type="text/javascript" src="https://mongocxx.org/js/navbar.js"></script>
<script type="text/javascript" src="https://mongocxx.org/lib/highlight/highlight.pack.js"></script>
<script type="text/javascript" src="https://mongocxx.org/js/scripts.js"></script>


<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-JQHP"
                 height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push(
  {'gtm.start': new Date().getTime(),event:'gtm.js'}
);var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'//www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-JQHP');</script>


<script type="text/javascript">
var _elqQ = _elqQ || [];
_elqQ.push(['elqSetSiteId', '413370795']);
_elqQ.push(['elqTrackPageView']);
(function () {
function async_load()
{ var s = document.createElement('script'); s.type = 'text/javascript'; s.async = true; s.src = '//img03.en25.com/i/elqCfg.min.js'; var x = document.getElementsByTagName('script')[0]; x.parentNode.insertBefore(s, x); }
if (window.addEventListener) window.addEventListener('DOMContentLoaded', async_load, false);
else if (window.attachEvent) window.attachEvent('onload', async_load);
})();
</script>


<script async src="https://www.googletagmanager.com/gtag/js?id=G-56KD6L3MDX"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-56KD6L3MDX');
</script>

</body>
</html>

