tasks:
  - name: abi-compliance-check
    run_on: ubuntu2204-large
    tags: [abi-stability, abi-compliance-check, ubuntu2204]
    commands:
      - func: abi-compliance-check
  - name: abi-prohibited-symbols
    run_on: ubuntu2204-large
    tags: [abi-stability, abi-prohibited-symbols, ubuntu2204]
    commands:
      - func: abi-prohibited-symbols
  - name: abidiff
    run_on: ubuntu2204-large
    tags: [abi-stability, abidiff, ubuntu2204]
    commands:
      - func: abidiff
  - name: atlas-search-indexes-7.0
    run_on: ubuntu2004-large
    tags: [atlas-search-indexes, ubuntu2004]
    commands:
      - func: install_c_driver
      - func: compile
        vars:
          build_type: Debug
      - func: test-search-index-helpers
  - name: atlas-search-indexes-8.0
    run_on: ubuntu2004-large
    tags: [atlas-search-indexes, ubuntu2004]
    commands:
      - func: install_c_driver
      - func: compile
        vars:
          build_type: Debug
      - func: test-search-index-helpers
  - name: clang-tidy
    run_on: ubuntu2004-small
    tags: [clang-tidy, ubuntu2004]
    commands:
      - func: setup
      - func: install_c_driver
        vars:
          cc_compiler: clang
          cxx_compiler: clang++
      - func: clang-tidy
        vars:
          cc_compiler: clang
          cxx_compiler: clang++
  - name: docker-build-ubuntu2204
    run_on: ubuntu2204-large
    tags: [docker-build, ubuntu2204]
    commands:
      - func: setup
      - func: docker-image-build
  - name: docker-build-ubuntu2204-arm64
    run_on: ubuntu2204-arm64-large
    tags: [docker-build, ubuntu2204-arm64]
    commands:
      - func: setup
      - func: docker-image-build
  - name: lint
    run_on: ubuntu1804-large
    tags: [lint, ubuntu1804]
    commands:
      - func: setup
      - func: lint
  - name: packaging-debian
    run_on: debian12-latest-large
    tags: [packaging, debian12-latest]
    commands:
      - func: setup
      - func: build-package-debian
  - name: packaging-debian-mnmlstc
    run_on: debian12-latest-large
    tags: [packaging, debian12-latest]
    commands:
      - func: setup
      - func: build-package-debian-mnmlstc
  - name: packaging-rpm
    run_on: rhel92-arm64-large
    tags: [packaging, rhel92-arm64]
    commands:
      - func: setup
      - func: build-package-rpm
  - name: silk
    run_on: rhel8-latest-small
    tags: [silk, rhel8-latest]
    commands:
      - func: setup
      - func: check augmented sbom
      - func: upload augmented sbom
  - name: test_mongohouse
    run_on: ubuntu2204-large
    tags: [mongohouse, ubuntu2204]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          build_type: Release
      - func: build_mongohouse
      - func: run_mongohouse
      - func: test_mongohouse
  - name: uninstall-check-debian10-gcc-release-shared
    run_on: debian10-large
    tags: [uninstall-check, debian10, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-debian11-gcc-release-shared
    run_on: debian11-large
    tags: [uninstall-check, debian11, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-debian12-gcc-release-shared
    run_on: debian12-large
    tags: [uninstall-check, debian12, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-ubuntu1804-gcc-release-shared
    run_on: ubuntu1804-large
    tags: [uninstall-check, ubuntu1804, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-ubuntu2004-gcc-release-shared
    run_on: ubuntu2004-large
    tags: [uninstall-check, ubuntu2004, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-vs2015-x64-debug-shared
    run_on: windows-64-vs2015-large
    tags: [uninstall-check, windows-64-vs2015, vs2015x64, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          generator: Visual Studio 14 2015
          platform: x64
      - func: uninstall-check
  - name: uninstall-check-vs2015-x64-release-shared
    run_on: windows-64-vs2015-large
    tags: [uninstall-check, windows-64-vs2015, vs2015x64, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          generator: Visual Studio 14 2015
          platform: x64
      - func: uninstall-check
