tasks:
  - name: abi-compliance-check
    run_on: ubuntu2204-large
    tags: [abi-stability, abi-compliance-check, ubuntu2204]
    commands:
      - func: abi-compliance-check
  - name: abi-prohibited-symbols
    run_on: ubuntu2204-large
    tags: [abi-stability, abi-prohibited-symbols, ubuntu2204]
    commands:
      - func: abi-prohibited-symbols
  - name: abidiff
    run_on: ubuntu2204-large
    tags: [abi-stability, abidiff, ubuntu2204]
    commands:
      - func: abidiff
  - name: atlas-search-indexes-7.0
    run_on: ubuntu2004-large
    tags: [atlas-search-indexes, ubuntu2004]
    commands:
      - func: install_c_driver
      - func: compile
        vars:
          build_type: Debug
      - func: test-search-index-helpers
  - name: atlas-search-indexes-8.0
    run_on: ubuntu2004-large
    tags: [atlas-search-indexes, ubuntu2004]
    commands:
      - func: install_c_driver
      - func: compile
        vars:
          build_type: Debug
      - func: test-search-index-helpers
  - name: clang-tidy
    run_on: ubuntu2004-small
    tags: [clang-tidy, ubuntu2004]
    commands:
      - func: setup
      - func: install_c_driver
        vars:
          cc_compiler: clang
          cxx_compiler: clang++
      - func: clang-tidy
        vars:
          cc_compiler: clang
          cxx_compiler: clang++
  - name: compile-only-rhel79-release-shared-impls
    run_on: rhel79-large
    tags: [compile-only, rhel79, release, shared, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: impls
          ENABLE_TESTS: "OFF"
          build_type: Release
  - name: compile-only-rhel81-power8-release-shared
    run_on: rhel81-power8-large
    tags: [compile-only, rhel81-power8, release, shared]
    patchable: false
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
  - name: compile-only-rhel83-zseries-release-shared
    run_on: rhel83-zseries-large
    tags: [compile-only, rhel83-zseries, release, shared]
    patchable: false
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
  - name: compile-only-ubuntu2004-clang-debug-shared
    run_on: ubuntu2004-large
    tags: [compile-only, ubuntu2004, clang, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          cc_compiler: clang
          cxx_compiler: clang++
  - name: compile-only-ubuntu2004-debug-shared
    run_on: ubuntu2004-large
    tags: [compile-only, ubuntu2004, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
  - name: compile-only-ubuntu2004-gcc-debug-shared
    run_on: ubuntu2004-large
    tags: [compile-only, ubuntu2004, gcc, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          cc_compiler: gcc
          cxx_compiler: g++
  - name: compile-only-vs2015-x64-debug-shared
    run_on: windows-64-vs2015-large
    tags: [compile-only, windows-64-vs2015, vs2015x64, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          generator: Visual Studio 14 2015
          platform: x64
  - name: compile-only-vs2015-x64-release-shared
    run_on: windows-64-vs2015-large
    tags: [compile-only, windows-64-vs2015, vs2015x64, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          generator: Visual Studio 14 2015
          platform: x64
  - name: docker-build-ubuntu2204
    run_on: ubuntu2204-large
    tags: [docker-build, ubuntu2204]
    commands:
      - func: setup
      - func: docker-image-build
  - name: docker-build-ubuntu2204-arm64
    run_on: ubuntu2204-arm64-large
    tags: [docker-build, ubuntu2204-arm64]
    commands:
      - func: setup
      - func: docker-image-build
  - name: lint
    run_on: ubuntu1804-large
    tags: [lint, ubuntu1804]
    commands:
      - func: setup
      - func: lint
  - name: packaging-debian
    run_on: debian12-latest-large
    tags: [packaging, debian12-latest]
    commands:
      - func: setup
      - func: build-package-debian
  - name: packaging-debian-mnmlstc
    run_on: debian12-latest-large
    tags: [packaging, debian12-latest]
    commands:
      - func: setup
      - func: build-package-debian-mnmlstc
  - name: packaging-rpm
    run_on: rhel92-arm64-large
    tags: [packaging, rhel92-arm64]
    commands:
      - func: setup
      - func: build-package-rpm
  - name: scan-build-ubuntu2204-std11-boost
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11, boost]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: boost
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std11-default
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std11-impls
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: impls
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std11-mnmlstc
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11, mnmlstc]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: mnmlstc
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-boost
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14, boost]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: boost
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-default
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-impls
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: impls
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-mnmlstc
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14, mnmlstc]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: mnmlstc
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std17-default
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std17]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          CXX_STANDARD: 17
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std17-impls
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std17, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: impls
          CXX_STANDARD: 17
      - func: upload scan artifacts
  - name: silk
    run_on: rhel8-latest-small
    tags: [silk, rhel8-latest]
    commands:
      - func: setup
      - func: check augmented sbom
      - func: upload augmented sbom
  - name: stub
    run_on: ubuntu2004-large
    commands:
      - command: subprocess.exec
        params:
          binary: bash
          args:
            - -c
            - "true"
  - name: test_mongohouse
    run_on: ubuntu2204-large
    tags: [mongohouse, ubuntu2204]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          build_type: Release
      - func: build_mongohouse
      - func: run_mongohouse
      - func: test_mongohouse
  - name: uninstall-check-debian10-gcc-release-shared
    run_on: debian10-large
    tags: [uninstall-check, debian10, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-debian11-gcc-release-shared
    run_on: debian11-large
    tags: [uninstall-check, debian11, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-debian12-gcc-release-shared
    run_on: debian12-large
    tags: [uninstall-check, debian12, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-ubuntu1804-gcc-release-shared
    run_on: ubuntu1804-large
    tags: [uninstall-check, ubuntu1804, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-ubuntu2004-gcc-release-shared
    run_on: ubuntu2004-large
    tags: [uninstall-check, ubuntu2004, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-vs2015-x64-debug-shared
    run_on: windows-64-vs2015-large
    tags: [uninstall-check, windows-64-vs2015, vs2015x64, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          generator: Visual Studio 14 2015
          platform: x64
      - func: uninstall-check
  - name: uninstall-check-vs2015-x64-release-shared
    run_on: windows-64-vs2015-large
    tags: [uninstall-check, windows-64-vs2015, vs2015x64, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          generator: Visual Studio 14 2015
          platform: x64
      - func: uninstall-check
