tasks:
  - name: abi-compliance-check
    run_on: ubuntu2204-large
    tags: [abi-stability, abi-compliance-check, ubuntu2204]
    commands:
      - func: abi-compliance-check
  - name: abi-prohibited-symbols
    run_on: ubuntu2204-large
    tags: [abi-stability, abi-prohibited-symbols, ubuntu2204]
    commands:
      - func: abi-prohibited-symbols
  - name: abidiff
    run_on: ubuntu2204-large
    tags: [abi-stability, abidiff, ubuntu2204]
    commands:
      - func: abidiff
  - name: atlas-search-indexes-7.0
    run_on: ubuntu2004-large
    tags: [atlas-search-indexes, ubuntu2004]
    commands:
      - func: install_c_driver
      - func: compile
        vars:
          build_type: Debug
      - func: test-search-index-helpers
  - name: atlas-search-indexes-8.0
    run_on: ubuntu2004-large
    tags: [atlas-search-indexes, ubuntu2004]
    commands:
      - func: install_c_driver
      - func: compile
        vars:
          build_type: Debug
      - func: test-search-index-helpers
  - name: benchmarks
    run_on: rhel90-dbx-perf-large
    tags: [benchmarks, rhel90-dbx-perf]
    commands:
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: v6.0-perf
      - func: fetch_c_driver_source
      - func: benchmarks-compile
      - func: benchmarks-run
  - name: clang-tidy
    run_on: ubuntu2004-small
    tags: [clang-tidy, ubuntu2004]
    commands:
      - func: setup
      - func: install_c_driver
        vars:
          cc_compiler: clang
          cxx_compiler: clang++
      - func: clang-tidy
        vars:
          cc_compiler: clang
          cxx_compiler: clang++
  - name: compile-only-rhel79-release-shared-impls
    run_on: rhel79-large
    tags: [compile-only, rhel79, release, shared, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: impls
          ENABLE_TESTS: "OFF"
          build_type: Release
  - name: compile-only-rhel81-power8-release-shared
    run_on: rhel81-power8-large
    tags: [compile-only, rhel81-power8, release, shared]
    patchable: false
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
  - name: compile-only-rhel83-zseries-release-shared
    run_on: rhel83-zseries-large
    tags: [compile-only, rhel83-zseries, release, shared]
    patchable: false
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
  - name: compile-only-ubuntu2004-clang-debug-shared
    run_on: ubuntu2004-large
    tags: [compile-only, ubuntu2004, clang, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          cc_compiler: clang
          cxx_compiler: clang++
  - name: compile-only-ubuntu2004-debug-shared
    run_on: ubuntu2004-large
    tags: [compile-only, ubuntu2004, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
  - name: compile-only-ubuntu2004-gcc-debug-shared
    run_on: ubuntu2004-large
    tags: [compile-only, ubuntu2004, gcc, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          cc_compiler: gcc
          cxx_compiler: g++
  - name: compile-only-vs2015-x64-debug-shared
    run_on: windows-64-vs2015-large
    tags: [compile-only, windows-64-vs2015, vs2015x64, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          generator: Visual Studio 14 2015
          platform: x64
  - name: compile-only-vs2015-x64-release-shared
    run_on: windows-64-vs2015-large
    tags: [compile-only, windows-64-vs2015, vs2015x64, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          generator: Visual Studio 14 2015
          platform: x64
  - name: docker-build-ubuntu2204
    run_on: ubuntu2204-large
    tags: [docker-build, ubuntu2204]
    commands:
      - func: setup
      - func: docker-image-build
  - name: docker-build-ubuntu2204-arm64
    run_on: ubuntu2204-arm64-large
    tags: [docker-build, ubuntu2204-arm64]
    commands:
      - func: setup
      - func: docker-image-build
  - name: integration-debian10-release-shared-5.0-replica
    run_on: debian10-large
    tags: [integration, debian10, release, shared, "5.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-debian10-release-shared-5.0-sharded
    run_on: debian10-large
    tags: [integration, debian10, release, shared, "5.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-debian10-release-shared-5.0-single
    run_on: debian10-large
    tags: [integration, debian10, release, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-debian10-release-shared-extra_alignment-5.0-single
    run_on: debian10-large
    tags: [integration, debian10, release, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-debian10-release-static-5.0-single
    run_on: debian10-large
    tags: [integration, debian10, release, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-debian10-release-static-extra_alignment-5.0-single
    run_on: debian10-large
    tags: [integration, debian10, release, static, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-debian11-release-shared-5.0-replica
    run_on: debian11-large
    tags: [integration, debian11, release, shared, "5.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-debian11-release-shared-5.0-sharded
    run_on: debian11-large
    tags: [integration, debian11, release, shared, "5.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-debian11-release-shared-5.0-single
    run_on: debian11-large
    tags: [integration, debian11, release, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-debian11-release-shared-cxx20-5.0-single
    run_on: debian11-large
    tags: [integration, debian11, release, shared, cxx20, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          REQUIRED_CXX_STANDARD: 20
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
  - name: integration-debian11-release-shared-cxx20-extra_alignment-5.0-single
    run_on: debian11-large
    tags: [integration, debian11, release, shared, cxx20, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          REQUIRED_CXX_STANDARD: 20
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
  - name: integration-debian11-release-shared-extra_alignment-5.0-single
    run_on: debian11-large
    tags: [integration, debian11, release, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-debian11-release-static-5.0-single
    run_on: debian11-large
    tags: [integration, debian11, release, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-debian11-release-static-extra_alignment-5.0-single
    run_on: debian11-large
    tags: [integration, debian11, release, static, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-debian12-release-shared-csfle-latest-replica
    run_on: debian12-large
    tags: [integration, debian12, release, shared, csfle, latest, replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-debian12-release-shared-csfle-latest-sharded
    run_on: debian12-large
    tags: [integration, debian12, release, shared, csfle, latest, sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-debian12-release-shared-cxx20-extra_alignment-latest-single
    run_on: debian12-large
    tags: [integration, debian12, release, shared, cxx20, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          REQUIRED_CXX_STANDARD: 20
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
  - name: integration-debian12-release-shared-cxx20-latest-single
    run_on: debian12-large
    tags: [integration, debian12, release, shared, cxx20, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          REQUIRED_CXX_STANDARD: 20
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
  - name: integration-debian12-release-shared-extra_alignment-latest-single
    run_on: debian12-large
    tags: [integration, debian12, release, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-debian12-release-shared-latest-single
    run_on: debian12-large
    tags: [integration, debian12, release, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-debian12-release-static-extra_alignment-latest-single
    run_on: debian12-large
    tags: [integration, debian12, release, static, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-debian12-release-static-latest-single
    run_on: debian12-large
    tags: [integration, debian12, release, static, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-macos-1100-release-shared-boost-5.0-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, shared, boost, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-macos-1100-release-shared-boost-extra_alignment-5.0-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, shared, boost, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-macos-1100-release-shared-boost-extra_alignment-latest-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, shared, boost, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-macos-1100-release-shared-boost-latest-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, shared, boost, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-macos-1100-release-static-boost-5.0-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, static, boost, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-macos-1100-release-static-boost-extra_alignment-5.0-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, static, boost, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-macos-1100-release-static-boost-extra_alignment-latest-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, static, boost, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-macos-1100-release-static-boost-latest-single
    run_on: macos-1100
    tags: [integration, macos-1100, release, static, boost, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-rhel81-power8-release-shared-5.0-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, shared, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel81-power8-release-shared-extra_alignment-5.0-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, shared, extra_alignment, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel81-power8-release-shared-extra_alignment-latest-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, shared, extra_alignment, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel81-power8-release-shared-latest-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, shared, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel81-power8-release-static-5.0-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, static, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel81-power8-release-static-extra_alignment-5.0-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, static, extra_alignment, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel81-power8-release-static-extra_alignment-latest-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, static, extra_alignment, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel81-power8-release-static-latest-single
    run_on: rhel81-power8-large
    tags: [integration, rhel81-power8, release, static, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-shared-5.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, shared, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-shared-6.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, shared, "6.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-shared-extra_alignment-5.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, shared, extra_alignment, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-shared-extra_alignment-6.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, shared, extra_alignment, "6.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-shared-extra_alignment-latest-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, shared, extra_alignment, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-shared-latest-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, shared, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-static-5.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, static, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-static-6.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, static, "6.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-static-extra_alignment-5.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, static, extra_alignment, "5.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-static-extra_alignment-6.0-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, static, extra_alignment, "6.0", single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-static-extra_alignment-latest-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, static, extra_alignment, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel83-zseries-release-static-latest-single
    run_on: rhel83-zseries-large
    tags: [integration, rhel83-zseries, release, static, latest, single]
    patchable: false
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-shared-csfle-latest-replica
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, shared, csfle, latest, replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-shared-csfle-latest-sharded
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, shared, csfle, latest, sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-shared-cxx20-extra_alignment-latest-single
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, shared, cxx20, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          REQUIRED_CXX_STANDARD: 20
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-shared-cxx20-latest-single
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, shared, cxx20, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          REQUIRED_CXX_STANDARD: 20
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-shared-extra_alignment-latest-single
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-shared-latest-single
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-static-extra_alignment-latest-single
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, static, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel90-arm64-release-static-latest-single
    run_on: rhel90-arm64-large
    tags: [integration, rhel90-arm64, release, static, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel90-release-shared-csfle-latest-replica
    run_on: rhel90-large
    tags: [integration, rhel90, release, shared, csfle, latest, replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
          lib_dir: lib64
  - name: integration-rhel90-release-shared-csfle-latest-sharded
    run_on: rhel90-large
    tags: [integration, rhel90, release, shared, csfle, latest, sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
          lib_dir: lib64
  - name: integration-rhel90-release-shared-cxx20-extra_alignment-latest-single
    run_on: rhel90-large
    tags: [integration, rhel90, release, shared, cxx20, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          REQUIRED_CXX_STANDARD: 20
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
          lib_dir: lib64
  - name: integration-rhel90-release-shared-cxx20-latest-single
    run_on: rhel90-large
    tags: [integration, rhel90, release, shared, cxx20, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          REQUIRED_CXX_STANDARD: 20
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          REQUIRED_CXX_STANDARD: 20
          example_projects_cxx_standard: 20
          lib_dir: lib64
  - name: integration-rhel90-release-shared-extra_alignment-latest-single
    run_on: rhel90-large
    tags: [integration, rhel90, release, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel90-release-shared-latest-single
    run_on: rhel90-large
    tags: [integration, rhel90, release, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          lib_dir: lib64
  - name: integration-rhel90-release-static-extra_alignment-latest-single
    run_on: rhel90-large
    tags: [integration, rhel90, release, static, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-rhel90-release-static-latest-single
    run_on: rhel90-large
    tags: [integration, rhel90, release, static, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
          lib_dir: lib64
  - name: integration-ubuntu1804-arm64-release-shared-5.0-single
    run_on: ubuntu1804-arm64-large
    tags: [integration, ubuntu1804-arm64, release, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-arm64-release-shared-extra_alignment-5.0-single
    run_on: ubuntu1804-arm64-large
    tags: [integration, ubuntu1804-arm64, release, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-arm64-release-static-5.0-single
    run_on: ubuntu1804-arm64-large
    tags: [integration, ubuntu1804-arm64, release, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-ubuntu1804-arm64-release-static-extra_alignment-5.0-single
    run_on: ubuntu1804-arm64-large
    tags: [integration, ubuntu1804-arm64, release, static, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-ubuntu1804-debug-shared-4.0-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, "4.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-4.2-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, "4.2", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.2"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-4.4-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, "4.4", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.4"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-5.0-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-6.0-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, "6.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-csfle-4.0-replica
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "4.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu1804-debug-shared-csfle-4.0-sharded
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "4.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu1804-debug-shared-csfle-4.2-replica
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.2", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "4.2"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu1804-debug-shared-csfle-4.2-replica-mongocryptd
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.2", replica, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "4.2"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
          use_mongocryptd: true
  - name: integration-ubuntu1804-debug-shared-csfle-4.2-sharded
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.2", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "4.2"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu1804-debug-shared-csfle-4.2-sharded-mongocryptd
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.2", sharded, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "4.2"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
          use_mongocryptd: true
  - name: integration-ubuntu1804-debug-shared-csfle-4.4-replica
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.4", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "4.4"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu1804-debug-shared-csfle-4.4-replica-mongocryptd
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.4", replica, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "4.4"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
          use_mongocryptd: true
  - name: integration-ubuntu1804-debug-shared-csfle-4.4-sharded
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.4", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "4.4"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu1804-debug-shared-csfle-4.4-sharded-mongocryptd
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "4.4", sharded, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "4.4"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
          use_mongocryptd: true
  - name: integration-ubuntu1804-debug-shared-csfle-5.0-replica
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "5.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu1804-debug-shared-csfle-5.0-replica-mongocryptd
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "5.0", replica, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
          use_mongocryptd: true
  - name: integration-ubuntu1804-debug-shared-csfle-5.0-sharded
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "5.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu1804-debug-shared-csfle-5.0-sharded-mongocryptd
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "5.0", sharded, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
          use_mongocryptd: true
  - name: integration-ubuntu1804-debug-shared-csfle-6.0-replica
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "6.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "6.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu1804-debug-shared-csfle-6.0-sharded
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, csfle, "6.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "6.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu1804-debug-shared-extra_alignment-4.0-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, extra_alignment, "4.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-extra_alignment-4.2-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, extra_alignment, "4.2", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.2"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-extra_alignment-4.4-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, extra_alignment, "4.4", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.4"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-extra_alignment-5.0-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-debug-shared-extra_alignment-6.0-single
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, debug, shared, extra_alignment, "6.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu1804-release-shared-5.0-replica
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, release, shared, "5.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu1804-release-shared-5.0-sharded
    run_on: ubuntu1804-large
    tags: [integration, ubuntu1804, release, shared, "5.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu2004-arm64-release-shared-extra_alignment-latest-single
    run_on: ubuntu2004-arm64-large
    tags: [integration, ubuntu2004-arm64, release, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-arm64-release-shared-latest-single
    run_on: ubuntu2004-arm64-large
    tags: [integration, ubuntu2004-arm64, release, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-arm64-release-static-extra_alignment-latest-single
    run_on: ubuntu2004-arm64-large
    tags: [integration, ubuntu2004-arm64, release, static, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-ubuntu2004-arm64-release-static-latest-single
    run_on: ubuntu2004-arm64-large
    tags: [integration, ubuntu2004-arm64, release, static, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-ubuntu2004-debug-shared-7.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, "7.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "7.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-debug-shared-8.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, "8.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "8.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-debug-shared-csfle-7.0-replica
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, "7.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "7.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu2004-debug-shared-csfle-7.0-sharded
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, "7.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "7.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu2004-debug-shared-csfle-8.0-replica
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, "8.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "8.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu2004-debug-shared-csfle-8.0-sharded
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, "8.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "8.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu2004-debug-shared-csfle-latest-replica
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, latest, replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu2004-debug-shared-csfle-latest-replica-mongocryptd
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, latest, replica, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
          use_mongocryptd: true
  - name: integration-ubuntu2004-debug-shared-csfle-latest-sharded
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, latest, sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu2004-debug-shared-csfle-latest-sharded-mongocryptd
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, csfle, latest, sharded, mongocryptd]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
          use_mongocryptd: true
  - name: integration-ubuntu2004-debug-shared-extra_alignment-7.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, extra_alignment, "7.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "7.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-debug-shared-extra_alignment-8.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, extra_alignment, "8.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "8.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-debug-shared-extra_alignment-latest-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-debug-shared-latest-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, debug, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-release-shared-5.0-replica
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, "5.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu2004-release-shared-5.0-sharded
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, "5.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu2004-release-shared-5.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-release-shared-csfle-5.0-replica
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, csfle, "5.0", replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu2004-release-shared-csfle-5.0-sharded
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, csfle, "5.0", sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu2004-release-shared-csfle-latest-replica
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, csfle, latest, replica]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: replica_set
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: replica
  - name: integration-ubuntu2004-release-shared-csfle-latest-sharded
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, csfle, latest, sharded]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          TOPOLOGY: sharded_cluster
          mongodb_version: latest
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: sharded
  - name: integration-ubuntu2004-release-shared-extra_alignment-5.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-release-shared-extra_alignment-latest-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-release-shared-latest-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
  - name: integration-ubuntu2004-release-static-5.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-ubuntu2004-release-static-extra_alignment-5.0-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, static, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-ubuntu2004-release-static-extra_alignment-latest-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, static, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-ubuntu2004-release-static-latest-single
    run_on: ubuntu2004-large
    tags: [integration, ubuntu2004, release, static, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Release }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_STATIC_LIBS: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          USE_STATIC_LIBS: 1
  - name: integration-windows-2019-vs2019-x64-debug-shared-4.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, "4.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-4.2-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, "4.2", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.2"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-4.4-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, "4.4", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.4"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-5.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-6.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, "6.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-7.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, "7.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "7.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-8.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, "8.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "8.0"
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-4.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, "4.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-4.2-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, "4.2", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.2"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-4.4-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, "4.4", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "4.4"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-5.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-6.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, "6.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "6.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-7.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, "7.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "7.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-8.0-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, "8.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "8.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-extra_alignment-latest-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: integration-windows-2019-vs2019-x64-debug-shared-latest-single
    run_on: windows-vsCurrent-large
    tags: [integration, windows-vsCurrent, debug, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: generator, value: Visual Studio 16 2019 }
            - { key: platform, value: x64 }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          example_projects_cxx_standard: 17
  - name: lint
    run_on: ubuntu1804-large
    tags: [lint, ubuntu1804]
    commands:
      - func: setup
      - func: lint
  - name: macro-guards-ubuntu2004
    run_on: ubuntu2004-large
    tags: [macro-guards, ubuntu2004]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          COMPILE_MACRO_GUARD_TESTS: "ON"
          build_type: Debug
  - name: macro-guards-ubuntu2004-clang
    run_on: ubuntu2004-large
    tags: [macro-guards, ubuntu2004, clang]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          COMPILE_MACRO_GUARD_TESTS: "ON"
          build_type: Debug
          cc_compiler: clang
          cxx_compiler: clang++
  - name: macro-guards-ubuntu2004-gcc
    run_on: ubuntu2004-large
    tags: [macro-guards, ubuntu2004, gcc]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          COMPILE_MACRO_GUARD_TESTS: "ON"
          build_type: Debug
          cc_compiler: gcc
          cxx_compiler: g++
  - name: packaging-debian
    run_on: debian12-latest-large
    tags: [packaging, debian12-latest]
    commands:
      - func: setup
      - func: build-package-debian
  - name: packaging-debian-mnmlstc
    run_on: debian12-latest-large
    tags: [packaging, debian12-latest]
    commands:
      - func: setup
      - func: build-package-debian-mnmlstc
  - name: packaging-rpm
    run_on: rhel92-arm64-large
    tags: [packaging, rhel92-arm64]
    commands:
      - func: setup
      - func: build-package-rpm
  - name: sanitizers-asan-ubuntu1804-clang-shared-5.0-single
    run_on: ubuntu1804-large
    tags: [sanitizers, asan, ubuntu1804, clang, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-asan-ubuntu1804-clang-shared-extra_alignment-5.0-single
    run_on: ubuntu1804-large
    tags: [sanitizers, asan, ubuntu1804, clang, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-asan-ubuntu1804-clang-static-5.0-single
    run_on: ubuntu1804-large
    tags: [sanitizers, asan, ubuntu1804, clang, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-asan-ubuntu1804-clang-static-extra_alignment-5.0-single
    run_on: ubuntu1804-large
    tags: [sanitizers, asan, ubuntu1804, clang, static, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-asan-ubuntu2004-clang-shared-5.0-single
    run_on: ubuntu2004-large
    tags: [sanitizers, asan, ubuntu2004, clang, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-asan-ubuntu2004-clang-shared-extra_alignment-5.0-single
    run_on: ubuntu2004-large
    tags: [sanitizers, asan, ubuntu2004, clang, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-asan-ubuntu2004-clang-static-5.0-single
    run_on: ubuntu2004-large
    tags: [sanitizers, asan, ubuntu2004, clang, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-asan-ubuntu2004-clang-static-extra_alignment-5.0-single
    run_on: ubuntu2004-large
    tags: [sanitizers, asan, ubuntu2004, clang, static, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          USE_SANITIZER_ASAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_ASAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=address -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=address
  - name: sanitizers-ubsan-ubuntu1804-clang-static-5.0-single
    run_on: ubuntu1804-large
    tags: [sanitizers, ubsan, ubuntu1804, clang, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_SANITIZER_UBSAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_UBSAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=undefined -fno-sanitize-recover=undefined -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=undefined -fno-sanitize-recover=undefined
  - name: sanitizers-ubsan-ubuntu2004-clang-static-5.0-single
    run_on: ubuntu2004-large
    tags: [sanitizers, ubsan, ubuntu2004, clang, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: cc_compiler, value: clang }
            - { key: cxx_compiler, value: clang++ }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
      - func: compile
        vars:
          RUN_DISTCHECK: 1
          USE_SANITIZER_UBSAN: "ON"
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_UBSAN: "ON"
          example_projects_cc: clang
          example_projects_cxx: clang++
          example_projects_cxxflags: -D_GLIBCXX_USE_CXX11_ABI=0 -fsanitize=undefined -fno-sanitize-recover=undefined -fno-omit-frame-pointer
          example_projects_ldflags: -fsanitize=undefined -fno-sanitize-recover=undefined
  - name: scan-build-ubuntu2204-std11-boost
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11, boost]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: boost
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std11-default
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std11-impls
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: impls
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std11-mnmlstc
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std11, mnmlstc]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: mnmlstc
          CXX_STANDARD: 11
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-boost
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14, boost]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: boost
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-default
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-impls
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: impls
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std14-mnmlstc
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std14, mnmlstc]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: mnmlstc
          CXX_STANDARD: 14
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std17-default
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std17]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          CXX_STANDARD: 17
      - func: upload scan artifacts
  - name: scan-build-ubuntu2204-std17-impls
    run_on: ubuntu2204-large
    tags: [scan-build, ubuntu2204, std17, impls]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: run scan build
        vars:
          BSONCXX_POLYFILL: impls
          CXX_STANDARD: 17
      - func: upload scan artifacts
  - name: silk
    run_on: rhel8-latest-small
    tags: [silk, rhel8-latest]
    commands:
      - func: setup
      - func: check augmented sbom
      - func: upload augmented sbom
  - name: test_mongohouse
    run_on: ubuntu2204-large
    tags: [mongohouse, ubuntu2204]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          build_type: Release
      - func: build_mongohouse
      - func: run_mongohouse
      - func: test_mongohouse
  - name: uninstall-check-debian10-gcc-release-shared
    run_on: debian10-large
    tags: [uninstall-check, debian10, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-debian11-gcc-release-shared
    run_on: debian11-large
    tags: [uninstall-check, debian11, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-debian12-gcc-release-shared
    run_on: debian12-large
    tags: [uninstall-check, debian12, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-ubuntu1804-gcc-release-shared
    run_on: ubuntu1804-large
    tags: [uninstall-check, ubuntu1804, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-ubuntu2004-gcc-release-shared
    run_on: ubuntu2004-large
    tags: [uninstall-check, ubuntu2004, gcc, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          cc_compiler: gcc
          cxx_compiler: g++
      - func: uninstall-check
  - name: uninstall-check-vs2015-x64-debug-shared
    run_on: windows-64-vs2015-large
    tags: [uninstall-check, windows-64-vs2015, vs2015x64, debug, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Debug
          generator: Visual Studio 14 2015
          platform: x64
      - func: uninstall-check
  - name: uninstall-check-vs2015-x64-release-shared
    run_on: windows-64-vs2015-large
    tags: [uninstall-check, windows-64-vs2015, vs2015x64, release, shared]
    commands:
      - func: setup
      - func: fetch_c_driver_source
      - func: compile
        vars:
          ENABLE_TESTS: "OFF"
          build_type: Release
          generator: Visual Studio 14 2015
          platform: x64
      - func: uninstall-check
  - name: valgrind-ubuntu1804-shared-5.0-single
    run_on: ubuntu1804-large
    tags: [valgrind, ubuntu1804, shared, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: valgrind-ubuntu1804-shared-extra_alignment-5.0-single
    run_on: ubuntu1804-large
    tags: [valgrind, ubuntu1804, shared, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: valgrind-ubuntu1804-static-5.0-single
    run_on: ubuntu1804-large
    tags: [valgrind, ubuntu1804, static, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: valgrind-ubuntu1804-static-extra_alignment-5.0-single
    run_on: ubuntu1804-large
    tags: [valgrind, ubuntu1804, static, extra_alignment, "5.0", single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: "5.0"
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: valgrind-ubuntu2004-shared-extra_alignment-latest-single
    run_on: ubuntu2004-large
    tags: [valgrind, ubuntu2004, shared, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: valgrind-ubuntu2004-shared-latest-single
    run_on: ubuntu2004-large
    tags: [valgrind, ubuntu2004, shared, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: valgrind-ubuntu2004-static-extra_alignment-latest-single
    run_on: ubuntu2004-large
    tags: [valgrind, ubuntu2004, static, extra_alignment, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          BSON_EXTRA_ALIGNMENT: 1
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          BSON_EXTRA_ALIGNMENT: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: valgrind-ubuntu2004-static-latest-single
    run_on: ubuntu2004-large
    tags: [valgrind, ubuntu2004, static, latest, single]
    commands:
      - command: expansions.update
        params:
          updates:
            - { key: build_type, value: Debug }
            - { key: USE_STATIC_LIBS, value: "1" }
      - func: setup
      - func: start_mongod
        vars:
          mongodb_version: latest
      - func: install_c_driver
        vars:
          SKIP_INSTALL_LIBMONGOCRYPT: 1
      - func: compile
        vars:
          RUN_DISTCHECK: 1
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          TEST_WITH_VALGRIND: "ON"
          disable_slow_tests: 1
          use_mongocryptd: true
  - name: versioned-api-one-required-macos-1100-release-shared-boost
    run_on: macos-1100
    tags: [versioned-api, macos-1100, release, shared, boost]
    commands:
      - func: setup
      - func: start_mongod
        vars:
          AUTH: noauth
          REQUIRE_API_VERSION: true
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          build_type: Release
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          MONGODB_API_VERSION: 1
          build_type: Release
  - name: versioned-api-one-required-ubuntu2004-debug-shared
    run_on: ubuntu2004-large
    tags: [versioned-api, ubuntu2004, debug, shared]
    commands:
      - func: setup
      - func: start_mongod
        vars:
          AUTH: noauth
          REQUIRE_API_VERSION: true
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          build_type: Debug
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          MONGODB_API_VERSION: 1
          build_type: Debug
  - name: versioned-api-one-required-windows-2019-vs2019-x64-debug-shared
    run_on: windows-vsCurrent-large
    tags: [versioned-api, windows-vsCurrent, vs2019x64, debug, shared]
    commands:
      - func: setup
      - func: start_mongod
        vars:
          AUTH: noauth
          REQUIRE_API_VERSION: true
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          build_type: Debug
          generator: Visual Studio 16 2019
          platform: x64
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          MONGODB_API_VERSION: 1
          build_type: Debug
          example_projects_cxx_standard: 17
          generator: Visual Studio 16 2019
          platform: x64
  - name: versioned-api-two-accepted-macos-1100-release-shared-boost
    run_on: macos-1100
    tags: [versioned-api, macos-1100, release, shared, boost]
    commands:
      - func: setup
      - func: start_mongod
        vars:
          AUTH: noauth
          ORCHESTRATION_FILE: versioned-api-testing.json
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          BSONCXX_POLYFILL: boost
          build_type: Release
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          build_type: Release
  - name: versioned-api-two-accepted-ubuntu2004-debug-shared
    run_on: ubuntu2004-large
    tags: [versioned-api, ubuntu2004, debug, shared]
    commands:
      - func: setup
      - func: start_mongod
        vars:
          AUTH: noauth
          ORCHESTRATION_FILE: versioned-api-testing.json
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          build_type: Debug
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          build_type: Debug
  - name: versioned-api-two-accepted-windows-2019-vs2019-x64-debug-shared
    run_on: windows-vsCurrent-large
    tags: [versioned-api, windows-vsCurrent, vs2019x64, debug, shared]
    commands:
      - func: setup
      - func: start_mongod
        vars:
          AUTH: noauth
          ORCHESTRATION_FILE: versioned-api-testing.json
          mongodb_version: latest
      - func: fetch_c_driver_source
      - func: compile
        vars:
          build_type: Debug
          generator: Visual Studio 16 2019
          platform: x64
      - func: fetch-det
      - func: run_kms_servers
      - func: test
        vars:
          MONGOCXX_TEST_TOPOLOGY: single
          build_type: Debug
          example_projects_cxx_standard: 17
          generator: Visual Studio 16 2019
          platform: x64
